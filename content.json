{"meta":{"title":"ã€‡","subtitle":"ä¸–ç•Œçš„æœ¬è´¨å³æ˜¯æ— é™çš„å¾ªç¯","description":null,"author":"rootReturn0","url":"http://rootreturn0.github.io","root":"/"},"pages":[{"title":"Categories","date":"2019-10-18T17:32:38.000Z","updated":"2019-10-18T17:35:35.924Z","comments":true,"path":"categories/index.html","permalink":"http://rootreturn0.github.io/categories/index.html","excerpt":"","text":""},{"title":"Tags","date":"2019-10-18T17:36:47.000Z","updated":"2019-10-18T17:37:11.283Z","comments":true,"path":"tags/index.html","permalink":"http://rootreturn0.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"ä¸Šä¼ æœ¬åœ°å›¾ç‰‡","slug":"ä¸Šä¼ æœ¬åœ°å›¾ç‰‡","date":"2019-10-18T17:48:13.000Z","updated":"2019-10-18T17:55:45.562Z","comments":true,"path":"2019/10/19/ä¸Šä¼ æœ¬åœ°å›¾ç‰‡/","link":"","permalink":"http://rootreturn0.github.io/2019/10/19/ä¸Šä¼ æœ¬åœ°å›¾ç‰‡/","excerpt":"","text":"å®‰è£…æ’ä»¶12cd /d ä½ çš„hexoæ ¹ç›®å½•npm install hexo-asset-image --save ä¿®æ”¹é…ç½®æ–‡ä»¶æ‰“å¼€æ ¹ç›®å½•ä¸‹çš„ _config.yml æ–‡ä»¶ï¼Œä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š 12345post_asset_folder: true# URL## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'url: http://yourname.github.io æ’å…¥å›¾ç‰‡è¿è¡Œ hexo n &quot;yourblogname&quot; ç”Ÿæˆåšæ–‡æ—¶ï¼Œ/source/_posts ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ªä¸ md åŒåçš„æ–‡ä»¶å¤¹ï¼Œå°†å›¾ç‰‡æ”¾äººè¯¥æ–‡ä»¶å¤¹ã€‚ 1ä½¿ç”¨![](yourblogname/picture.jpg)æ’å…¥å›¾ç‰‡å³å¯ã€‚","categories":[{"name":"å»ºç«™æ—¥å¿—","slug":"å»ºç«™æ—¥å¿—","permalink":"http://rootreturn0.github.io/categories/å»ºç«™æ—¥å¿—/"}],"tags":[{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"http://rootreturn0.github.io/tags/æ—¥å¿—/"}]},{"title":"å¢åŠ é¡µé¢","slug":"å¢åŠ é¡µé¢","date":"2019-10-18T17:46:34.000Z","updated":"2019-10-18T17:57:34.098Z","comments":true,"path":"2019/10/19/å¢åŠ é¡µé¢/","link":"","permalink":"http://rootreturn0.github.io/2019/10/19/å¢åŠ é¡µé¢/","excerpt":"","text":"æ ‡ç­¾ğŸ”—å®˜æ–¹é“¾æ¥ æ–°å»ºä¸€ä¸ªé¡µé¢ 1hexo new page tags ç¼–è¾‘æ–°å»ºç•Œé¢ï¼Œå°†é¡µé¢ç±»å‹è®¾ç½®ä¸º tags ï¼Œä¸»é¢˜å°†ä¼šåœ¨è¿™ä¸ªé¡µé¢ä¸Šæ˜¾ç¤ºæ ‡ç­¾äº‘ã€‚ 12345---title: Tagsdate: 2019-10-19 01:26:01type: \"tags\"--- å»é™¤ä¸»é¢˜é…ç½®æ–‡ä»¶ _config.yml ä¸­ tags çš„æ³¨é‡Šã€‚ 123456789menu: home: / || home #about: /about/ || user tags: /tags/ || tags categories: /categories/ || th archives: /archives/ || archive #schedule: /schedule/ || calendar #sitemap: /sitemap.xml || sitemap #commonweal: /404/ || heartbeat æ ‡ç­¾çš„ä½¿ç”¨1tags: xxx æˆ– 123tags:- xxx- xxx æ³¨æ„ï¼šä½¿ç”¨ç¬¬äºŒç§æ–¹å¼æ—¶ï¼Œä¸ºå¹¶åˆ—æ ‡ç­¾ï¼Œæ— ç­‰çº§åŒºåˆ†ã€‚ åˆ†ç±»ğŸ”—å®˜æ–¹é“¾æ¥ æ–°å»ºä¸€ä¸ªé¡µé¢ 1hexo new page categories ç¼–è¾‘æ–°å»ºç•Œé¢ï¼Œå°†é¡µé¢ç±»å‹è®¾ç½®ä¸º categories ï¼Œä¸»é¢˜å°†ä¼šåœ¨è¿™ä¸ªé¡µé¢ä¸Šæ˜¾ç¤ºæ‰€æœ‰çš„åˆ†ç±»ã€‚ 12345---title: Categoriesdate: 2019-10-19 01:26:08type: \"categories\"--- å»é™¤ä¸»é¢˜é…ç½®æ–‡ä»¶ _config.yml ä¸­ categories çš„æ³¨é‡Šã€‚ 123456789menu: home: / || home #about: /about/ || user tags: /tags/ || tags categories: /categories/ || th archives: /archives/ || archive #schedule: /schedule/ || calendar #sitemap: /sitemap.xml || sitemap #commonweal: /404/ || heartbeat åˆ†ç±»çš„ä½¿ç”¨1categories: xxx æˆ– 123categories:- xxx- xxx æ³¨æ„ï¼šä½¿ç”¨ç¬¬äºŒç§æ–¹å¼æ—¶ï¼Œå¹¶éå¹¶åˆ—åˆ†ç±»ï¼Œè€Œæ˜¯åˆ†çº§åˆ†ç±»ã€‚å…¶ä¸­è¶Šé å‰çš„è¶Šé«˜çº§ã€‚","categories":[{"name":"å»ºç«™æ—¥å¿—","slug":"å»ºç«™æ—¥å¿—","permalink":"http://rootreturn0.github.io/categories/å»ºç«™æ—¥å¿—/"}],"tags":[{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"http://rootreturn0.github.io/tags/æ—¥å¿—/"}]},{"title":"Androidå­¦ä¹ ç¬”è®°_Activity","slug":"Androidå­¦ä¹ ç¬”è®°-Activity","date":"2019-10-18T14:07:48.000Z","updated":"2019-10-19T05:49:13.732Z","comments":true,"path":"2019/10/18/Androidå­¦ä¹ ç¬”è®°-Activity/","link":"","permalink":"http://rootreturn0.github.io/2019/10/18/Androidå­¦ä¹ ç¬”è®°-Activity/","excerpt":"ç¬”è®°åŸºäºéƒ­éœ–å¤§ç¥æ‰€è‘—çš„ã€Šç¬¬ä¸€è¡Œä»£ç ã€‹ç¬¬äºŒç‰ˆä¹‹ç¬¬2ç« ã€‚ å…¶ä¸­ï¼š ä½¿ç”¨çš„IDEï¼šAndroid Studio ç¤ºä¾‹é¡¹ç›®åï¼šActivityTest åŒ…åï¼šâ€œcom.example.avtivitytestâ€","text":"ç¬”è®°åŸºäºéƒ­éœ–å¤§ç¥æ‰€è‘—çš„ã€Šç¬¬ä¸€è¡Œä»£ç ã€‹ç¬¬äºŒç‰ˆä¹‹ç¬¬2ç« ã€‚ å…¶ä¸­ï¼š ä½¿ç”¨çš„IDEï¼šAndroid Studio ç¤ºä¾‹é¡¹ç›®åï¼šActivityTest åŒ…åï¼šâ€œcom.example.avtivitytestâ€ æ‰‹åŠ¨åˆ›å»ºæ´»åŠ¨æ–°å»ºé¡¹ç›®æ—¶é€‰æ‹©Add No Activity åˆå§‹æ–‡ä»¶ç»“æ„ å³å‡»com.example.activityteståŒ…-&gt;New-&gt;Activity-&gt;Empty Activityï¼Œä¼šå¼¹å‡ºå¯¹è¯æ¡†ï¼Œå…¶ä¸­ Generate LayoutFile ä¼šåœ¨app/src/main/resç›®å½•ä¸­ä¸ºè¯¥æ´»åŠ¨è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„ layout çš„ xml æ–‡ä»¶ï¼›Launcher Activity ä¼šå°†è¯¥æ´»åŠ¨è®¾ç½®ä¸ºç¨‹åºè¿è¡Œæ—¶é¦–å…ˆåŠ è½½çš„æ´»åŠ¨ï¼Œå³å½“å‰é¡¹ç›®çš„ä¸»æ´»åŠ¨ã€‚ åˆ›å»ºå’ŒåŠ è½½å¸ƒå±€å³å‡»app/src/main/resç›®å½•-&gt;New-&gt;Directoryï¼Œå¯åˆ›å»ºä¸€ä¸ªåä¸º layout çš„ç›®å½•ï¼Œè€Œåå³å‡»è¯¥ç›®å½•ï¼Œå³å¯æ–°å»ºå¸ƒå±€æ–‡ä»¶ã€‚ æ·»åŠ æŒ‰é’®12345678910111213&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:orientation=\"vertical\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt; &lt;Button android:id=\"@+id/button_1\" // å®šä¹‰id android:layout_width=\"match_parent\" // è¡¨ç¤ºå’Œçˆ¶å…ƒç´ ä¸€æ ·å®½ android:layout_height=\"wrap_content\" // è¡¨ç¤ºå½“å‰å…ƒç´ çš„é«˜åº¦æ°å¥½åŒ…å«é‡Œé¢å†…å®¹ android:text=\"Button_1\" /&gt;&lt;/LinearLayout&gt; åŠ è½½123456789101112131415package com.example.activitytest;import androidx.appcompat.app.AppCompatActivity;import android.os.Bundle;public class FirstActivity extends AppCompatActivity &#123; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); // æœ¬è¡Œå°†layoutçš„idä¼ å…¥ï¼Œä¸ºå½“å‰æ´»åŠ¨åŠ è½½å¸ƒå±€ setContentView(R.layout.thirt_layout); &#125;&#125; åœ¨AndroidManifestæ–‡ä»¶æ³¨å†Œ1234567891011121314151617181920212223&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;manifest xmlns:android=\"http://schemas.android.com/apk/res/android\" package=\"com.example.activitytest\"&gt; &lt;application android:allowBackup=\"true\" android:icon=\"@mipmap/ic_launcher\" android:label=\"@string/app_name\" android:roundIcon=\"@mipmap/ic_launcher_round\" android:supportsRtl=\"true\" android:theme=\"@style/AppTheme\"&gt; &lt;activity android:name=\".FirstActivity\" // æŒ‡å®šæ³¨å†Œæ´»åŠ¨ android:label=\"This is FirstActivity\" &gt; // æŒ‡å®šæ´»åŠ¨æ ‡é¢˜æ å†…å®¹ &lt;intent-filter&gt; // ä»¥ä¸‹ä¸¤è¡Œå°†æ´»åŠ¨é…ç½®ä¸ºä¸»æ´»åŠ¨ &lt;action android:name=\"android.intent.action.MAIN\" /&gt; &lt;category android:name=\"android.intent.category.LAUNCHER\" /&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;/application&gt;&lt;/manifest&gt; ToaståŠæŒ‰é’®å“åº”123456789101112protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.first_layout); Button button1 = (Button) findViewById(R.id.button_1); button1.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View view) &#123; Toast.makeText(FirstActivity.this, \"You clicked Button_1!\", Toast.LENGTH_SHORT).show(); &#125; &#125;);&#125; é€šè¿‡ findViewById() æ–¹æ³•è·å–åˆ°å¸ƒå±€æ–‡ä»¶ä¸­å®šä¹‰çš„å…ƒç´ ï¼Œè¿™é‡Œä¼ å…¥ R.id.button_1 æ¥å¾—åˆ°æŒ‰é’®çš„å®ä¾‹ï¼Œè€Œåæ³¨å†Œç›‘å¬å™¨ã€‚ Toast ä¸­ makeText æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ Contextï¼ˆæ´»åŠ¨æ˜¯ä¸€ç§ä¸Šä¸‹æ–‡ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ Toast æ˜¾ç¤ºçš„æ–‡æœ¬å†…å®¹ï¼Œç¬¬ä¸‰ä¸ªæ˜¯æŒç»­æ—¶é•¿ã€‚æ³¨æ„ï¼Œåªæœ‰åŠ ä¸Šåé¢çš„ .show() ï¼ŒToast æ‰ä¼šæ˜¾ç¤ºã€‚ Menuä½¿ç”¨ Android æä¾›çš„æ–¹å¼åˆ›å»ºèœå•ã€‚èœå•é€šè¿‡åº”ç”¨å³ä¸Šè§’çš„ä¸‰ä¸ªç‚¹çš„å°æŒ‰é’®ï¼Œä»¥åˆ—è¡¨å½¢å¼æ˜¾ç¤ºã€‚ åˆ›å»ºèœå•å³å‡»app/src/main/resç›®å½•-&gt;New-&gt;Directoryï¼Œåˆ›å»ºåä¸º menu çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º main çš„èœå•æ–‡ä»¶ï¼ˆå³å‡»menu-&gt;New-&gt;Menu resource fileï¼‰ã€‚ åœ¨main.xmlæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š 123456789&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;menu xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt; &lt;item android:id=\"@+id/add_item\"// æ ‡è¯†ç¬¦ android:title=\"Add\" // åç§° /&gt; &lt;item android:id=\"@+id/remove_item\" android:title=\"Remove\" /&gt;&lt;/menu&gt; å…¶ä¸­itemæ ‡ç­¾ç”¨æ¥åˆ›å»ºå…·ä½“çš„èœå•é¡¹ã€‚ è€Œååœ¨FirstActivityä¸­é‡å†™å‡½æ•°ï¼š 123456public boolean onCreateOptionsMenu(Menu menu)&#123; // ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºèµ„æºæ–‡ä»¶ï¼Œç¬¬äºŒä¸ªæŒ‡å®šæ·»åŠ åˆ°çš„Menuå¯¹è±¡ getMenuInflater().inflate(R.menu.main, menu); // è¡¨ç¤ºæ˜¯å¦å…è®¸æ˜¾ç¤ºèœå• return true; &#125; èœå•å“åº”åœ¨FirstActivityä¸­é‡å†™å‡½æ•°ï¼š 1234567891011121314public boolean onOptionsItemSelected(@NonNull MenuItem item) &#123; // åˆ¤æ–­ç‚¹å‡»çš„èœå•é¡¹ switch (item.getItemId())&#123; case R.id.add_item: Toast.makeText(this,\"You clicked Add\",Toast.LENGTH_SHORT).show(); break; case R.id.remove_item: Toast.makeText(this,\"You clicked Remove\",Toast.LENGTH_LONG).show(); break; default: &#125; return super.onOptionsItemSelected(item);&#125; é”€æ¯æ´»åŠ¨åœ¨æ¨¡æ‹Ÿå™¨ä¸­æŒ‰ä¸‹ Back é”®ï¼Œæˆ–è°ƒç”¨finish()æ–¹æ³•ã€‚ 1234567891011protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.first_layout); Button button1 = (Button) findViewById(R.id.button_1); button1.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View view) &#123; finish() &#125; &#125;);&#125; ä½¿ç”¨Intentåˆ‡æ¢æ´»åŠ¨æ˜¾å¼Intentåˆ›å»ºç¬¬äºŒä¸ªæ´»åŠ¨ï¼Œåä¸º SecondActivityã€‚ ä¿®æ”¹FirstActivityä¸­çš„æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼š 1234567891011121314protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.first_layout); Button button1 = (Button) findViewById(R.id.button_1); button1.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View view) &#123; // ä¼ å…¥ FirstActivity.this ä½œä¸ºä¸Šä¸‹æ–‡ï¼ŒSecondActivity.classä¸ºç›®æ ‡æ´»åŠ¨ Intent intent = new Intent(FirstActivity.this,SecondActivity.class); startActivity(intent); &#125; &#125;);&#125; éšå¼Intenté€šè¿‡AndroidManifest.xmlä¸­çš„activityæ ‡ç­¾ä¸‹é…ç½®&lt;intent-filter&gt;å†…å®¹ï¼Œå¯ä»¥æŒ‡å®šå½“å‰æ´»åŠ¨èƒ½å¤Ÿå“åº”çš„ action å’Œ categoryã€‚åªæœ‰&lt;action&gt;å’Œ&lt;category&gt;ä¸­çš„å†…å®¹èƒ½å¤ŸåŒæ—¶åŒ¹é… Intent æŒ‡å®šçš„å†…å®¹æ—¶ï¼Œæ´»åŠ¨æ‰èƒ½å“åº”ã€‚ ä»£ç å¦‚ä¸‹ï¼š 123456&lt;activity android:name=\".SecondActivity\"&gt; &lt;intent-filter&gt; &lt;action android:name=\"com.example.activitytest.ACTION_START\" /&gt; &lt;category android:name=\"android.intent.category.DEFAULT\" /&gt; &lt;/intent-filter&gt;&lt;/activity&gt; ä¿®æ”¹FirstActivityä¸­çš„æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼š 12345678910111213protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.first_layout); Button button1 = (Button) findViewById(R.id.button_1); button1.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View view) &#123; Intent intent = new Intent(\"com.example.activitytest.ACTION_START\"); startActivity(intent); &#125; &#125;);&#125; å¢åŠ Categoryåœ¨AndroidManifestä¸­é…ç½®å¦‚ä¸‹ï¼š 123456789&lt;activity android:name=\".SecondActivity\"&gt; &lt;intent-filter&gt; &lt;action android:name=\"com.example.activitytest.ACTION_START\" /&gt; &lt;category android:name=\"android.intent.category.DEFAULT\" /&gt; // ä¸æ·»åŠ ä¸‹è¡Œä»£ç å°†å¯¼è‡´ç¨‹åºå´©æºƒ &lt;category android:name=\"com.example.activitytest.MY_CATEGORY\" /&gt; &lt;/intent-filter&gt;&lt;/activity&gt; ä¿®æ”¹FirstActivityä¸­çš„æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼š 1234567891011121314protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.first_layout); Button button1 = (Button) findViewById(R.id.button_1); button1.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View view) &#123; Intent intent = new Intent(\"com.example.activitytest.ACTION_START\"); intent.addCategory(\"com.example.activitytest.MY_CATEGORY\"); startActivity(intent); &#125; &#125;);&#125; å…¶ä»–Intentç”¨æ³•å¯åŠ¨å…¶ä»–åº”ç”¨ç¨‹åºä¿®æ”¹FirstActivityä¸­çš„æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼š 123456789101112131415protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.first_layout); Button button1 = (Button) findViewById(R.id.button_1); button1.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View view) &#123; Intent intent = new Intent(Intent.ACTION_VIEW); // æ³¨æ„ï¼šâ€œhttp://â€ ä¸èƒ½çœç•¥ intent.setData(Uri.parse(\"http://ww.baidu.com\")); startActivity(intent); &#125; &#125;);&#125; æ­¤æ—¶ç‚¹å‡»æŒ‰é’®å¯è·³è½¬è‡³æµè§ˆå™¨æ‰“å¼€ â€œwww.baidu.com&quot;ã€‚ åœ¨AndroidManifestä¸­çš„&lt;intent-filter&gt;æ ‡ç­¾é…ç½®&lt;data&gt;æ ‡ç­¾ï¼Œå¯æŒ‡å®šæ´»åŠ¨èƒ½å¤Ÿå“åº”çš„ç±»å‹æ•°æ®ã€‚&lt;data&gt;æ ‡ç­¾ä¸»è¦å¯é…ç½®ä»¥ä¸‹å†…å®¹ï¼š android:scheme åè®®ï¼Œå¦‚ http android:host ä¸»æœºå android:port ç«¯å£ android:path ä»¥ä¸Šä¹‹åçš„éƒ¨åˆ† android:mimeType å¯å¤„ç†çš„æ•°æ®ç±»å‹ ç¤ºä¾‹ï¼š 1234567&lt;activity android:name=\".ThirdActivity\"&gt; &lt;intent-filter&gt; &lt;action android:name=\"android.intent.action.VIEW\" /&gt; &lt;category android:name=\"android.intent.category.DEFAULT\" /&gt; &lt;data android:scheme=\"http\" /&gt; &lt;/intent-filter&gt;&lt;/activity&gt; å½“å‰æ´»åŠ¨èƒ½å¤Ÿå“åº”çš„ action æ˜¯ Intent.ACTION_VIEW çš„å¸¸é‡å€¼ï¼Œæ•°æ®åè®®å¿…é¡»æ˜¯ httpã€‚åœ¨ç‚¹å‡»æŒ‰é’®åï¼Œè¯¥æ´»åŠ¨ä¹Ÿèƒ½å“åº”Intentï¼š é€‰æ‹©å“åº”Intentçš„ç¨‹åº ä»ç”¨æˆ·ä½“éªŒçš„è§’åº¦æ¥çœ‹ï¼Œå¦‚æœæ´»åŠ¨æœ¬èº«ä¸å…·å¤‡åŠ è½½å¹¶æ˜¾ç¤ºçš„ç½‘é¡µçš„åŠŸèƒ½ï¼Œåƒä¸‡ä¸è¦è¿™ä¹ˆç”¨å•Šï¼ï¼ï¼ é™¤ http åè®®å¤–ï¼Œè¿˜æœ‰è®¸å¤š Uri åè®®ï¼Œå¸¸ç”¨çš„ Uri åè®®è§ &lt;&lt;Android å¸¸ç”¨URI å€¼å¾—è®°ä½&gt;&gt;ã€‚ ä¼ é€’æ•°æ®Intent ä¸­æä¾›äº†ä¸€ç³»åˆ— putExtra() æ–¹æ³•çš„é‡è½½ï¼Œå¯ä»¥å°†æƒ³è¦ä¼ é€’çš„æ•°æ®æš‚å­˜åœ¨ Intent ä¸­ã€‚å½“å¯åŠ¨å¦ä¸€ä¸ª Intent åï¼Œåªéœ€è¦æŠŠè¿™äº›æ•°æ®å†ä» Intent ä¸­å–å‡ºå³å¯ã€‚ å‘ä¸‹ä¸€ä¸ªæ´»åŠ¨ä¼ é€’æ•°æ®å‡è®¾ FirstActivity ä¸­æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç°åœ¨æƒ³æŠŠè¿™ä¸ªå­—ç¬¦ä¸²ä¼ é€’åˆ° SecondActivity ä¸­ï¼Œå¯ä»¥è¿™æ ·ç¼–å†™ä»£ç ï¼š 12345678910button1.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View view) &#123; String data = \"Hello SecondActivity\"; Intent intent = new Intent(FirstActivity.this,SecondActivity.class); // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é”®ï¼Œç”¨äºä¹‹åå–å€¼ï¼›ç¬¬äºŒä¸ªå‚æ•°ä¸ºè¦ä¼ é€’çš„æ•°æ® intent.putExtra(\"extra_data\",data); startActivity(intent); &#125;&#125;); SecondActivity ä¸­æ¥æ”¶ä»£ç ï¼š 123456789101112131415161718public class SecondActivity extends AppCompatActivity &#123; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_second); // è·å–ç”¨äºå¯åŠ¨ SecondActivity çš„Intent Intent intent = getIntent(); /** * getStringExtra() è·å–å­—ç¬¦ä¸²æ•°æ®ï¼› * å¦‚æœæ˜¯æ•´å‹æ•°æ®åˆ™ç”¨ getIntExtra()ï¼› * å¦‚æœæ˜¯å¸ƒå°”æ•°æ®åˆ™ç”¨ getBooleanExtra()ï¼› * ä»¥æ­¤ç±»æ¨ã€‚ * / String data = intent.getStringExtra(\"extra_data\"); Log.d(\"SecondActivity\",data); &#125;&#125; è¿”å›æ•°æ®ç»™ä¸Šä¸€ä¸ªæ´»åŠ¨Activity ä¸­è¿˜æœ‰ä¸€ä¸ªstartActivityForResult()æ–¹æ³•ä¹Ÿå¯ä»¥å¯åŠ¨æ´»åŠ¨ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªæ–¹æ³•æœŸæœ›åœ¨æ´»åŠ¨é”€æ¯æ—¶èƒ½è¿‡è¿”å›ç»“æœç»™ä¸Šä¸€ä¸ªæ´»åŠ¨ã€‚è¦æƒ³è¿”å›æ•°æ®ï¼Œåˆ™éœ€è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼š 12345678910111213button1.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View view) &#123; Intent intent = new Intent(FirstActivity.this,SecondActivity.class); intent.putExtra(\"extra_data\",data); /** * ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯intentï¼› * ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¯·æ±‚ç ï¼Œç”¨äºåœ¨ä¹‹åçš„å›è°ƒä¸­åˆ¤æ–­æ•°æ®çš„æ¥æºï¼Œ * è¯·æ±‚ç åªè¦æ˜¯ä¸€ä¸ªå”¯ä¸€å€¼å°±è¡Œã€‚ * / startActivityForResult(intent, 1); &#125;&#125;);","categories":[{"name":"Android","slug":"Android","permalink":"http://rootreturn0.github.io/categories/Android/"}],"tags":[{"name":"å­¦ä¹ ","slug":"å­¦ä¹ ","permalink":"http://rootreturn0.github.io/tags/å­¦ä¹ /"}]},{"title":"Haydn","slug":"Haydn","date":"2019-10-07T18:12:49.000Z","updated":"2019-10-18T17:10:41.363Z","comments":true,"path":"2019/10/08/Haydn/","link":"","permalink":"http://rootreturn0.github.io/2019/10/08/Haydn/","excerpt":"","text":"æœ‰æ—¶å¹¶éæ¬¢å¿«åœ°è·³è·ƒç€çš„ã€‚ ä½†å´ä¾æ—§èˆ’ç¼“äººç–²æƒ«çš„å¿ƒçµã€‚ éå±±æ²³å£®é˜”ï¼Œ éäººé—´æ˜Ÿç«ï¼Œ éå¤©å¤–é£ä»™ã€‚ è€Œæ˜¯æµæ·Œåœ¨æ˜¥å¤©çš„ç”Ÿæ­»æ˜ç­ã€‚","categories":[{"name":"Me","slug":"Me","permalink":"http://rootreturn0.github.io/categories/Me/"}],"tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"http://rootreturn0.github.io/tags/éšç¬”/"}]},{"title":"R","slug":"C","date":"2019-10-07T09:28:19.000Z","updated":"2019-10-18T17:10:32.520Z","comments":true,"path":"2019/10/07/C/","link":"","permalink":"http://rootreturn0.github.io/2019/10/07/C/","excerpt":"","text":"åœ¨æ›¾ç»æœ€ä½è°·çš„æ—¶å€™ï¼ˆæå°å€¼ï¼‰ï¼Œ å¥¹æ¿€åŠ±äº†æˆ‘ï¼› åœ¨ç°åœ¨æœ€åº•è°·çš„æ—¶å€™ï¼ˆæå°å€¼ï¼‰ï¼Œ å¥¹å®‰æ…°äº†æˆ‘ã€‚ æœç„¶æ˜¯æˆ‘ç”Ÿå‘½ä¸­é‡è¦çš„ä¸€ä¸ªäººï¼ˆç¬‘ CAUSE AND CONSEQUENCE","categories":[{"name":"Me","slug":"Me","permalink":"http://rootreturn0.github.io/categories/Me/"}],"tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"http://rootreturn0.github.io/tags/éšç¬”/"}]},{"title":"xv6-è°ƒåº¦","slug":"xv6-è°ƒåº¦","date":"2019-08-31T10:50:22.000Z","updated":"2019-10-18T17:14:32.392Z","comments":true,"path":"2019/08/31/xv6-è°ƒåº¦/","link":"","permalink":"http://rootreturn0.github.io/2019/08/31/xv6-è°ƒåº¦/","excerpt":"","text":"è°ƒåº¦ç”±äºå¯èƒ½åŒæ—¶æœ‰å¤šä¸ªCPUè¯·æ±‚è¿›è¡Œè°ƒåº¦ï¼Œæ•…éœ€è¦è¿›ç¨‹è¡¨é”ptable.lockæ¥é¿å…ç«äº‰ã€‚ å› æ­¤ï¼Œè¿›ç¨‹åœ¨è®©å‡ºCPUå‰ï¼Œå¿…é¡»è¦è·å¾—è¿›ç¨‹è¡¨é”ï¼Œå¹¶é‡Šæ”¾å…¶æ‹¥æœ‰çš„å…¶ä»–é”ï¼ˆé¿å…åŒæ—¶æŒæœ‰å¤šä¸ªé”å¯¼è‡´æ­»é”ï¼‰ï¼Œä¿®æ”¹è‡ªå·±çš„çŠ¶æ€proc-&gt;stateï¼Œç„¶åè¿›è¡Œè°ƒåº¦ã€‚ å‡½æ•°ä»¥ä¸‹å‡½æ•°ä½äºä»£ç æ–‡ä»¶proc.cä¸­ã€‚ schedè¿›ç¨‹è¿›å…¥è°ƒåº¦å™¨ï¼Œä¸”å¿…é¡»æŒæœ‰è¿›ç¨‹è¡¨é”å¹¶æ”¹å˜è¿›ç¨‹çŠ¶æ€ã€‚ç”±äºè¿›ç¨‹æ­¤æ—¶æŒæœ‰è¿›ç¨‹è¡¨é”ï¼Œæ‰€ä»¥CPUåº”è¯¥æ˜¯åœ¨å…³ä¸­æ–­çš„æƒ…å†µä¸‹è¿è¡Œã€‚ 12345678910111213141516171819202122voidsched(void)&#123; int intena; struct proc *p = myproc(); // æœªæŒæœ‰è¿›ç¨‹è¡¨é”ï¼Œä¸åº”è¿›å…¥è°ƒåº¦ï¼Œå¼•å‘å†…æ ¸é”™è¯¯ if(!holding(&amp;ptable.lock)) panic(\"sched ptable.lock\"); // å¤„äºé”çŠ¶æ€ï¼Œä¸åº”è¿›å…¥è°ƒåº¦ï¼Œå¼•å‘å†…æ ¸é”™è¯¯ if(mycpu()-&gt;ncli != 1) panic(\"sched locks\"); // è¿›ç¨‹å¤„äºè¿è¡Œæ€ï¼Œä¸åº”è¿›å…¥è°ƒåº¦ï¼Œå¼•å‘å†…æ ¸é”™è¯¯ if(p-&gt;state == RUNNING) panic(\"sched running\"); // å¼€ä¸­æ–­ï¼Œä¸å¯æ‰§è¡Œmycpu()å‡½æ•°ï¼Œä¸åº”è¿›å…¥è°ƒåº¦ï¼Œå¼•å‘å†…æ ¸é”™è¯¯ if(readeflags()&amp;FL_IF) panic(\"sched interruptible\"); intena = mycpu()-&gt;intena; // æš‚å­˜çŠ¶æ€ swtch(&amp;p-&gt;context, mycpu()-&gt;scheduler); // ä¿å­˜å½“å‰ä¸Šä¸‹æ–‡ï¼Œå¹¶åˆ‡æ¢åˆ°ä¹‹å‰ä¿å­˜çš„è°ƒåº¦å™¨çš„ä¸Šä¸‹æ–‡ï¼Œè¿›å…¥è°ƒåº¦å™¨ mycpu()-&gt;intena = intena; // æ¢å¤çŠ¶æ€&#125; yieldåœ¨xv6ä¸­ï¼Œä½¿ç”¨æ—¶é—´ç‰‡è½®è½¬æ³•è¿›è¡Œè°ƒåº¦ã€‚å½“è¿›ç¨‹ç”¨å®Œå®ƒçš„CPUæ—¶é—´ç‰‡æ—¶ï¼Œæ—¶é’Ÿä¸­æ–­ä¼šè°ƒç”¨yieldå‡½æ•°æ¥è®©å‡ºCPUç»™æ–°çš„è¿›ç¨‹ï¼Œyieldè°ƒç”¨schedå‡½æ•°ï¼Œschedè°ƒç”¨swtchæ¥åˆ‡æ¢éƒ½è°ƒåº¦å™¨çº¿ç¨‹ï¼š 12345678voidyield(void)&#123; acquire(&amp;ptable.lock); //DOC: yieldlock è¯·æ±‚è¿›ç¨‹è¡¨é” myproc()-&gt;state = RUNNABLE; // åˆ‡æ¢è¿›ç¨‹çŠ¶æ€ sched(); release(&amp;ptable.lock); // é‡Šæ”¾è¿›ç¨‹è¡¨é”&#125; scheduleræ¯ä¸ªCPUåœ¨è®¾ç½®å®Œæˆè‡ªå·±ä¹‹åè°ƒç”¨schedulerã€‚ è°ƒåº¦å™¨scheduleræ°¸è¿œä¸ä¼šè¿”å›ï¼Œè€Œæ˜¯ä¸æ–­å¾ªç¯ã€‚å¾ªç¯æ­¥éª¤ä¸ºï¼š é€‰æ‹©è¦è¿è¡Œçš„æµç¨‹ swtchå¼€å§‹è¿è¡Œè¯¥è¿‡ç¨‹ æœ€ç»ˆè¯¥è¿‡ç¨‹é€šè¿‡swtchå°†æ§åˆ¶è½¬ç§»å›è°ƒåº¦ç¨‹åºã€‚ 1234567891011121314151617181920212223242526272829303132333435363738voidscheduler(void)&#123; struct proc *p; struct cpu *c = mycpu(); c-&gt;proc = 0; // ä¸æ–­å¾ªç¯ï¼Œæ°¸ä¸åœæ­¢ for(;;)&#123; // å¼€ä¸­æ–­ï¼Œä»¥å…è®¸I/Oåˆ°è¾¾ sti(); // åœ¨è¿›ç¨‹è¡¨ä¸Šä¸æ–­å¾ªç¯ï¼Œå¯»æ‰¾è¿›ç¨‹å¹¶è¿è¡Œ acquire(&amp;ptable.lock); // è¯·æ±‚è¿›ç¨‹è¡¨é” for(p = ptable.proc; p &lt; &amp;ptable.proc[NPROC]; p++)&#123; if(p-&gt;state != RUNNABLE) // è¿›ç¨‹ä¸å¯è¿è¡Œï¼Œè½¬åˆ°ä¸‹ä¸€ä¸ªè¿›ç¨‹ continue; // Switch to chosen process. It is the process's job // to release ptable.lock and then reacquire it // before jumping back to us. // åˆ‡æ¢åˆ°é€‰å®šçš„è¿›ç¨‹ c-&gt;proc = p; switchuvm(p); // åˆ‡æ¢åˆ°è¯¥è¿›ç¨‹çš„é¡µè¡¨ p-&gt;state = RUNNING; swtch(&amp;(c-&gt;scheduler), p-&gt;context); // åˆ‡æ¢åˆ°è¯¥è¿›ç¨‹è¿è¡Œ switchkvm(); // å½“æ²¡æœ‰è¿›ç¨‹æ­£åœ¨è¿è¡Œæ—¶ï¼Œå°†é¡µè¡¨å¯„å­˜å™¨åˆ‡æ¢åˆ°ä»…å†…æ ¸é¡µè¡¨ã€‚ // Process is done running for now. // It should have changed its p-&gt;state before coming back. // è¿›ç¨‹å·²ç»“æŸè¿è¡Œï¼Œæ”¹å˜è‡ªèº«çŠ¶æ€ c-&gt;proc = 0; &#125; release(&amp;ptable.lock); // é‡Šæ”¾è¿›ç¨‹è¡¨é”ï¼Œé˜²æ­¢å…¶ä»–CPUæ— æ³•è¿›è¡Œè°ƒåº¦ &#125;&#125; é”ä¸ä¸­æ–­é” ä¸ºä¿è¯è¿›ç¨‹çŠ¶æ€çš„ä¸Šä¸‹æ–‡åœ¨è¿è¡Œswtchæ—¶ä¿æŒä¸å˜ï¼šè¿›ç¨‹è¡¨é”ç”±æ—§è¿›ç¨‹è·å¾—ï¼Œæ–°è¿›ç¨‹é‡Šæ”¾ã€‚ ä¸ºé˜²æ­¢å…¶ä»–CPUé—²ç½®æ—¶é”è¢«å½“å‰CPUå æœ‰è€Œæ— æ³•è°ƒåº¦ï¼Œå…¶ä»–CPUä¸Šè¿è¡Œè¿›ç¨‹æ— æ³•è®©å‡ºCPUï¼Œå¯¼è‡´æ­»é”çš„æƒ…å†µï¼šåœ¨éå†ä¸€æ¬¡è¿›ç¨‹è¡¨åæ€»è¦é‡Šæ”¾é”ã€‚ ä¸­æ–­ ä¸ºé˜²æ­¢æ‰€æœ‰è¿›ç¨‹éƒ½åœ¨ç­‰å¾…I/Oæ—¶å…³ä¸­æ–­å¯¼è‡´çš„I/Oæ— æ³•åˆ°è¾¾å¼•å‘çš„æ­»é”ï¼Œè°ƒåº¦å™¨åœ¨æ¯æ¬¡å¾ªåå¼€å§‹å‰è¿›è¡Œå¼€ä¸­æ–­ã€‚ ç¡çœ ä¸å”¤é†’å‡½æ•°sleepå’Œwakeupä½äºä»£ç æ–‡ä»¶proc.cä¸­ã€‚ ä½¿è¿›ç¨‹è¿›å…¥ç¡çœ æˆ–è¿›è¡Œå”¤é†’å‡éœ€è¦æ”¹å˜è¿›ç¨‹çŠ¶æ€ï¼Œæ•…éœ€è¦è¿›ç¨‹è¡¨é”ä»¥ä¿è¯çŠ¶æ€ä¿®æ”¹çš„åŸå­æ€§ã€‚å…¶ä¸­å‡½æ•°sleepè¦åœ¨ä½¿è¿›ç¨‹è¿›å…¥ç¡çœ å‰è·å–è¿›ç¨‹è¡¨é”ï¼Œä»¥ä¿è¯åœ¨ä½¿å‡½æ•°è¿›å…¥ç¡çœ æ—¶è‡³å°‘æŒæœ‰ä¸€ä¸ªé”ï¼Œé˜²æ­¢wakeupåœ¨è¿›ç¨‹è¿›å…¥ç¡çœ å‰è¢«è°ƒç”¨å¯¼è‡´çš„æ­»é”ã€‚å½“sleepæœ¬èº«æŒæœ‰çš„é”ä¸ºè¿›ç¨‹è¡¨é”æ—¶ï¼Œåˆ™ç•¥è¿‡è¯·æ±‚è¿™ä¸€æ­¥ï¼Œé˜²æ­¢æ­»é”ã€‚ å¯æ”¹è¿›ä¹‹å¤„è°ƒåº¦ è½®è½¬æ³•æ— ä¼˜å…ˆçº§çš„åŒºåˆ† ä¼šå¯¼è‡´é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹æ— æ³•ä¼˜å…ˆè¿è¡Œï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿè¿è¡Œæ—¶é—´çš„å¢åŠ ï¼Œå½±å“ä½¿ç”¨è€…åœ¨å®é™…ä½¿ç”¨æ—¶çš„ä½“éªŒã€‚å¯ä½¿ç”¨å…¶ä»–è¾ƒä¸ºå¤æ‚çš„ç®—æ³•ï¼Œå¦‚é«˜å“åº”æ¯”ä¼˜å…ˆç®—æ³•ç­‰ä»¥æ”¹è¿›ä½“éªŒã€‚ ç¡çœ ä¸å”¤é†’ å”¤é†’éœ€è¦éå†è¿›ç¨‹è¡¨ åœ¨è¿›ç¨‹æ•°é‡å¤§çš„æ—¶å€™è¿™ç§åšæ³•æ•ˆç‡æä½ã€‚ä½¿ç”¨å¦ä¸€ä¸ªç»“æ„ä½“æ¥ç»´æŠ¤é“¾è¡¨å¯å¤§å¤§æé«˜æ•ˆç‡ã€‚ å”¤é†’æ—¶ä¼šå”¤é†’é˜Ÿåˆ—ä¸­å…¨éƒ¨è¿›ç¨‹ å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒåŒä¸€æ—¶é—´éœ€è¦å”¤é†’çš„è¿›ç¨‹åœ¨é˜Ÿåˆ—ä¸­æ˜¯å°‘æ•°éƒ¨åˆ†ï¼Œè®¸å¤šä»éœ€ç­‰å¾…çš„è¿›ç¨‹å°†ä¼šè¢«â€œè«åå…¶å¦™â€åœ°å”¤é†’å¹¶å†åº¦æ£€æŸ¥çŠ¶æ€é‡æ–°è¿›å…¥ç¡çœ ï¼Œå¯¼è‡´æ“ä½œç³»ç»Ÿéœ€è¦å¤„ç†è®¸å¤šæ–°çš„ä¸å¿…è¦çš„ä»»åŠ¡ã€‚ å”¤é†’æ—¶åº”åˆ†ä¸ºä¸ªä½“å”¤é†’ï¼ˆå”¤é†’å•ä¸ªè¿›ç¨‹ï¼‰å’Œç¾¤ä½“å”¤é†’ï¼ˆå”¤é†’æ‰€æœ‰è¿›ç¨‹ï¼‰ï¼Œå‡å°‘ç³»ç»Ÿè´Ÿæ‹…ã€‚","categories":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"http://rootreturn0.github.io/categories/æ“ä½œç³»ç»Ÿ/"}],"tags":[{"name":"å­¦ä¹ ","slug":"å­¦ä¹ ","permalink":"http://rootreturn0.github.io/tags/å­¦ä¹ /"}]},{"title":"xv6-ç®¡é“","slug":"xv6-ç®¡é“","date":"2019-08-31T00:29:38.000Z","updated":"2019-10-18T17:14:24.466Z","comments":true,"path":"2019/08/31/xv6-ç®¡é“/","link":"","permalink":"http://rootreturn0.github.io/2019/08/31/xv6-ç®¡é“/","excerpt":"","text":"ç®¡é“ä»ç®¡é“çš„ä¸€ç«¯å†™å…¥æ•°æ®å­—èŠ‚ï¼Œç„¶åæ•°æ®è¢«æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºä¸­ï¼Œæ¥ç€è¿›ç¨‹å°±èƒ½ä»ç®¡é“çš„å¦ä¸€ç«¯è¯»å–æ•°æ®äº†ã€‚ åœ¨xv6ä¸­ï¼Œç®¡é“ä½¿ç”¨è¢«è¯»å–å­—èŠ‚æ•°nreadå’Œè¢«å†™å…¥å­—èŠ‚æ•°nwriteçš„å·®å€¼åˆ¤æ–­ç®¡é“çŠ¶æ€ï¼š nwrite == nread åˆ™æ•°æ®æœªå†™å…¥æˆ–è¢«è¯»å–å®Œæ¯•ï¼Œç®¡é“ç©º nwrite == nread + PIPESIZE åˆ™ç®¡é“æ»¡ ç”±äºç®¡é“çš„è¯»å–ä¸å†™å…¥å‡éœ€è¦ä½¿ç”¨nreadå’Œnwriteä»¥è·æ‚‰ç®¡é“çŠ¶æ€ï¼Œæ•…è¿™ä¸¤ä¸ªè®¡æ•°å‚æ•°ä¸èƒ½åœ¨æŸä¸€å‡½æ•°ï¼ˆå†™å…¥/è¯»å–ï¼‰æ¸…é›¶ï¼Œå¦åˆ™å°†å½±å“å¦ä¸€å‡½æ•°ï¼ˆè¯»å–/å†™å…¥ï¼‰çš„æ‰§è¡Œã€‚å› æ­¤ï¼Œxv6ä¸­ä½¿ç”¨data[nread % PIPESIZE]å’Œdata[nwrite % PIPESIZE]æ¥æ§åˆ¶è¯»å†™æ—¶çš„ç®¡é“æ•°æ®åç§»ï¼Œå³å¾ªç¯å†™/è¯»ï¼Œåœ¨data[PIPESIZE-1]åå†™å…¥çš„æ•°æ®å­˜æ”¾åœ¨data[0]ä¸­ã€‚ æ•°æ®ç»“æ„12345678struct pipe &#123; struct spinlock lock; // é” char data[PIPESIZE]; // ç®¡é“æ•°æ® uint nread; // è¢«è¯»å–å­—èŠ‚æ•°ï¼Œä»ç¼“å†²åŒºä¸­è¯»å– uint nwrite; // è¢«å†™å…¥å­—èŠ‚æ•°ï¼Œå†™å…¥ç¼“å†²åŒº int readopen; // è¯»æ–‡ä»¶æè¿°ç¬¦æ˜¯å¦ä¾æ—§å¤„äºopençŠ¶æ€ int writeopen; // å†™æ–‡ä»¶æè¿°ç¬¦æ˜¯å¦ä¾æ—§å¤„äºopençŠ¶æ€&#125;; ç®¡é“å‡½æ•°ä»¥ä¸‹åˆ†æç®¡é“è¯»å†™å‡½æ•°ï¼Œå…¶ä»–å‡½æ•°ä»…åˆ—å‡ºå‡½æ•°ä½œç”¨ï¼Œè¯¦ç»†æ³¨é‡Šè§ä»£ç æ–‡ä»¶pipe.cã€‚ è¯»å†™ç®¡é“è¯»å†™æ“ä½œé€šè¿‡ç®¡é“é”å®ç°äº’æ–¥ï¼Œæ“ä½œè¿è¡Œæ—¶å¿…é¡»æŒæœ‰ç®¡é“é”ã€‚ ç®¡é“æ•°æ®å†™å…¥æ—¶é¦–å…ˆè·å–ç®¡é“é”è€Œåå†™å…¥æ•°æ®ï¼Œè‹¥è¾¾åˆ°ç®¡é“å®¹é‡ä¸Šé™ï¼Œåˆ™å†™æ“ä½œå”¤é†’è¯»æ“ä½œåè¿›å…¥ç¡çœ ç­‰å¾…å¹¶é‡Šæ”¾ç®¡é“é”ã€‚æ­¤æ—¶è¯»æ“ä½œå¯è·å¾—è¯·æ±‚çš„ç®¡é“é”ï¼Œåœ¨è¯»å–å®Œæ•°æ®åç®¡é“å˜ç©ºï¼Œåˆ™è¯»æ“ä½œå”¤é†’å†™æ“ä½œåè¿›å…¥ç¡çœ ç­‰å¾…å¹¶é‡Šæ”¾ç®¡é“é”ã€‚è€Œåç®¡é“å†™æ“ä½œå†æ¬¡è·å¾—ç®¡é“é”ï¼Œå¾ªç¯å¾€å¤ç›´è‡³æ•°æ®ä¼ è¾“å®Œæ¯•ï¼Œå…¶ä¸­æœ€åä¸€æ¬¡ä¼ è¾“å¯èƒ½æœªå†™æ»¡ç®¡é“ã€‚ å½“ä½¿ç”¨ç®¡é“çš„æ“ä½œè¢«æ€åï¼Œç®¡é“è¯»å†™æ“ä½œéƒ½å°†ç»ˆæ­¢ï¼›å½“ç®¡é“ä¸å¯è¯»æ—¶ï¼Œç®¡é“å†™æ“ä½œå°†è¢«ç»ˆæ­¢ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748// ç®¡é“å†™intpipewrite(struct pipe *p, char *addr, int n)&#123; int i; acquire(&amp;p-&gt;lock); // è¯·æ±‚è·å¾—ç®¡é“é”ï¼Œä»¥ä¿æŠ¤è®¡æ•°å™¨ã€æ•°æ®ä»¥åŠç›¸å…³ä¸å˜é‡ for(i = 0; i &lt; n; i++)&#123; while(p-&gt;nwrite == p-&gt;nread + PIPESIZE)&#123; // ç®¡é“æ»¡ // å¦‚æœç®¡é“æ–‡ä»¶ä¸å¯è¯»æˆ–è¿›ç¨‹è¢«æ€ï¼Œé‡Šæ”¾ç®¡é“é”å¹¶ç»ˆæ­¢ç®¡é“å†™æ“ä½œ if(p-&gt;readopen == 0 || myproc()-&gt;killed)&#123; release(&amp;p-&gt;lock); return -1; &#125; wakeup(&amp;p-&gt;nread); // é€šçŸ¥ç¡çœ ä¸­çš„è¯»è€…ç¼“å†²åŒºä¸­æœ‰æ•°æ®å¯è¯» sleep(&amp;p-&gt;nwrite, &amp;p-&gt;lock); // ç®¡é“å†™æ“ä½œè¿›å…¥ç¡çœ ç­‰å¾…ï¼ˆç¡çœ æ—¶å°†é‡Šæ”¾ç®¡é“é”ï¼‰ &#125; p-&gt;data[p-&gt;nwrite++ % PIPESIZE] = addr[i]; // å°†æ‰€éœ€è¯»å–çš„å—å†…æ•°æ®èµ‹å€¼ç»™ç®¡é“æ•°æ® &#125; wakeup(&amp;p-&gt;nread); // é€šçŸ¥ç¡çœ ä¸­çš„è¯»è€…ç¼“å†²åŒºä¸­æœ‰æ•°æ®å¯è¯» release(&amp;p-&gt;lock); // é‡Šæ”¾ç®¡é“é” return n;&#125;//ç®¡é“è¯»intpiperead(struct pipe *p, char *addr, int n)&#123; int i; acquire(&amp;p-&gt;lock); // è¯·æ±‚è·å¾—ç®¡é“é”ï¼Œä»¥ä¿æŠ¤è®¡æ•°å™¨ã€æ•°æ®ä»¥åŠç›¸å…³ä¸å˜é‡ while(p-&gt;nread == p-&gt;nwrite &amp;&amp; p-&gt;writeopen)&#123; //DOC: ç®¡é“ä¸ºç©ºä¸”ç®¡é“å¯å†™ï¼Œåˆ™ç®¡é“è¯»æ“ä½œå¯è¿›å…¥ç¡çœ  // è¿›ç¨‹è¢«æ€ï¼Œé‡Šæ”¾ç®¡é“é”ï¼Œç»ˆæ­¢ç®¡é“è¯»æ“ä½œ if(myproc()-&gt;killed)&#123; release(&amp;p-&gt;lock); return -1; &#125; sleep(&amp;p-&gt;nread, &amp;p-&gt;lock); //DOC: piperead-sleep ç®¡é“è¯»æ“ä½œè¿›å…¥ç¡çœ ç­‰å¾…ï¼ˆç¡çœ æ—¶å°†é‡Šæ”¾ç®¡é“é”ï¼‰ &#125; for(i = 0; i &lt; n; i++)&#123; // æ‹·è´æ•°æ® if(p-&gt;nread == p-&gt;nwrite) // è¯»å–å­—èŠ‚æ•°ç­‰äºå†™å…¥å­—èŠ‚æ•°ï¼Œè¡¨ç¤ºè¯»å–å®Œæˆ break; addr[i] = p-&gt;data[p-&gt;nread++ % PIPESIZE]; // å°†æ‰€éœ€è¯»å–çš„ç®¡é“æ•°æ®èµ‹å€¼ç»™å—å†…æ•°æ® &#125; wakeup(&amp;p-&gt;nwrite); // é€šçŸ¥ç¡çœ ä¸­çš„å†™è€…ç¼“å†²åŒºä¸­å¯å†™ release(&amp;p-&gt;lock); return i;&#125; å…¶ä»– pipealloc ç®¡é“åˆ†é…ï¼Œå¹¶åˆå§‹åŒ–ç®¡é“ã€‚ pipeclose ç®¡é“å…³é—­ã€‚è‹¥è¯»å†™ä¸¤æ–¹å‡å…³é—­ï¼Œåˆ™é‡Šæ”¾å†…å­˜ï¼›å¦åˆ™å…³é—­ç®¡é“ä¸€ç«¯å¹¶å”¤é†’å¦ä¸€æ–¹ã€‚å½“å…³é—­å†™ç«¯æ—¶ï¼Œä»å¯è¿›è¡Œè¯»æ“ä½œï¼Œä½†å°†ç®¡é“å†…å‰©ä½™æ•°æ®è¯»å®Œåï¼Œå†æ¬¡è¿›è¡Œè¯»æ“ä½œä¾¿è¿”å›0ï¼Œç›¸å½“äºè¯»åˆ°æ–‡ä»¶æœ«å°¾ï¼›å½“å…³é—­è¯»æ®µæ—¶ï¼Œå†™æ“ä½œä¼šåœ¨è¿›è¡Œè¿‡ç¨‹ä¸­ä¸­æ–­ã€‚","categories":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"http://rootreturn0.github.io/categories/æ“ä½œç³»ç»Ÿ/"}],"tags":[{"name":"å­¦ä¹ ","slug":"å­¦ä¹ ","permalink":"http://rootreturn0.github.io/tags/å­¦ä¹ /"}]},{"title":"xv6-æ–‡ä»¶ç³»ç»Ÿ","slug":"xv6-æ–‡ä»¶ç³»ç»Ÿ","date":"2019-08-30T17:47:50.000Z","updated":"2019-10-18T17:14:13.038Z","comments":true,"path":"2019/08/31/xv6-æ–‡ä»¶ç³»ç»Ÿ/","link":"","permalink":"http://rootreturn0.github.io/2019/08/31/xv6-æ–‡ä»¶ç³»ç»Ÿ/","excerpt":"","text":"æ–‡ä»¶ç³»ç»Ÿæ€»ä½“è®¾è®¡æ–‡ä»¶ç³»ç»Ÿåˆ†å±‚ å¦‚å›¾æ‰€ç¤ºxv6çš„æ–‡ä»¶ç³»ç»Ÿåˆ†6å±‚å®ç°ï¼š ç¬¬ä¸€å±‚ï¼ˆè‡ªä¸‹è€Œä¸Šï¼‰é€šè¿‡å—ç¼“å†²è¯»å†™ IDE ç¡¬ç›˜ï¼ŒåŒæ­¥å¯¹ç£ç›˜çš„è®¿é—®ï¼Œä¸”é€šè¿‡å—çš„é”ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªå†…æ ¸è¿›ç¨‹å¯ä»¥ä¿®æ”¹ç£ç›˜å—ï¼› ç¬¬äºŒå±‚ä½¿å¾—æ›´é«˜å±‚çš„æ¥å£å¯ä»¥å°†å¯¹ç£ç›˜çš„æ›´æ–°æŒ‰ä¼šè¯æ‰“åŒ…ï¼Œé€šè¿‡ä¼šè¯çš„æ–¹å¼æ¥ä¿è¯è¿™äº›æ“ä½œæ˜¯åŸå­æ“ä½œã€‚ ç¬¬ä¸‰å±‚æä¾›æ— åæ–‡ä»¶ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶ç”±ä¸€ä¸ªinodeå’Œä¸€è¿ä¸²çš„æ•°æ®å—ç»„æˆã€‚ ç¬¬å››å±‚å°†ç›®å½•å®ç°ä¸ºä¸€ç§ç‰¹æ®Šçš„inodeï¼Œå†…å®¹æ˜¯ä¸€è¿ä¸²çš„ç›®å½•é¡¹ï¼Œæ¯ä¸€ä¸ªç›®å½•é¡¹åŒ…å«ä¸€ä¸ªæ–‡ä»¶åå’Œå¯¹åº”çš„inodeã€‚ ç¬¬äº”å±‚æä¾›äº†å±‚æ¬¡è·¯ç»åï¼ˆå¦‚/xx/xxxï¼‰ï¼Œè¿™ä¸€å±‚é€šè¿‡é€’å½’çš„æ–¹å¼æ¥æŸ¥è¯¢è·¯å¾„å¯¹åº”çš„æ–‡ä»¶ã€‚ ç¬¬å…­å±‚å°†è®¸å¤šèµ„æºï¼ˆå¦‚ç®¡é“ï¼Œè®¾å¤‡ï¼Œæ–‡ä»¶ç­‰ï¼‰æŠ½è±¡ä¸ºæ–‡ä»¶ç³»ç»Ÿçš„æ¥å£ï¼Œæå¤§åœ°ç®€åŒ–äº†ç¨‹åºå‘˜çš„å·¥ä½œã€‚ ç£ç›˜åˆ†å±‚ç£ç›˜åˆ†å±‚ä¸ºå¼•å¯¼å—ã€è¶…çº§å—ã€æ—¥å¿—å—ã€inodeå—ã€ç©ºé—²å—ä½å›¾å’Œæ•°æ®å—ç­‰ã€‚ æ–‡ä»¶ç³»ç»Ÿä¸ä½¿ç”¨å¼•å¯¼å—ï¼›è¶…çº§å—åŒ…å«äº†æ–‡ä»¶ç³»ç»Ÿçš„å…ƒä¿¡æ¯ï¼›æ—¥å¿—å—ä¸­çš„æ—¥å¿—ç»´æŠ¤äº†æ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„åŸå­æ€§ï¼Œé˜²æ­¢æ“ä½œè¿‡ç¨‹ä¸­å¼•å‘çš„ç³»ç»Ÿå´©æºƒè€Œå¯¼è‡´çš„æ•°æ®ä¸åŒæ­¥ï¼›inodeå—ç”¨äºå­˜æ”¾inodeï¼ˆä¸€ä¸ªå—å¯å­˜æ”¾å¤šä¸ªinodeï¼‰ï¼›ç©ºé—²å—ä½å›¾ä¾¿äºæŸ¥æ‰¾ç©ºé—²çš„å—ï¼›æ•°æ®å—ä¸­ä¿å­˜äº†æ–‡ä»¶å’Œç›®å½•ç­‰å†…å®¹ã€‚ å—ç¼“å†²å±‚éœ€è¦å®ç°çš„ç›®æ ‡ åŒæ­¥å¯¹ç£ç›˜çš„è®¿é—®ã€‚å¯¹äºä»»æ„ä¸€ä¸ªå—ï¼ŒåŒä¸€æ—¶é—´ä»…æœ‰ä¸€ä»½æ‹·è´æ”¾åœ¨å†…å­˜ä¸­ä¸”åªå…è®¸ä¸€ä¸ªå†…æ ¸çº¿ç¨‹å¯¹è¯¥æ‹·è´è¿›è¡Œä¿®æ”¹ã€‚ ç¼“å­˜å¸¸ç”¨çš„å—ä»¥å‡å°‘ç£ç›˜è¯»å–æ¬¡æ•°ï¼Œæé«˜ç³»ç»Ÿæ•ˆç‡ã€‚ å®ç°æ–¹æ¡ˆä»£ç å‚è§bio.cã€‚ æ ¹æ®æ—¶é—´ä¸ç©ºé—´å±€éƒ¨æ€§åŸç†ï¼Œå°†æœ€è¿‘ç»å¸¸è®¿é—®çš„ç£ç›˜å—ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä½¿ç”¨LRUæ›¿æ¢ç­–ç•¥ã€‚ ç»“æ„å®šä¹‰xv6å°†ç¼“å†²åŒºåˆ†ä¸ºä¸¤ç§çŠ¶æ€ï¼š B_VALID æ„å‘³ç€è¿™ä¸ªç¼“å†²åŒºæ‹¥æœ‰ç£ç›˜å—çš„æœ‰æ•ˆå†…å®¹ï¼› B_DIRTY æ„å‘³ç€ç¼“å†²åŒºçš„å†…å®¹å·²ç»è¢«æ”¹å˜å¹¶ä¸”éœ€è¦å†™å›ç£ç›˜ï¼› ä¸æ—§ç‰ˆç›¸æ¯”ï¼ŒB_BUSY çŠ¶æ€åœ¨æœ€æ–°ç‰ˆä»£ç ä¸­è¢«åˆ å»ã€‚ä½†ç”±äºç¼“å­˜åŒºä¸­çš„å—çš„é”çš„å­˜åœ¨ï¼Œåªæœ‰æŒæœ‰é”æ‰èƒ½è®¿é—®è¯¥å—ï¼Œè€Œåœ¨å¦ä¸€çº¿ç¨‹æœªä½¿ç”¨å®Œæˆå‰ï¼Œè¯¥é”ä¸ä¼šè¢«é‡Šæ”¾ï¼Œæ­¤æ—¶åªèƒ½å¾ªç¯ç­‰å¾…é”çš„é‡Šæ”¾ï¼Œè·å¾—é”åæ–¹å¯è·å¾—å—ã€‚æ•…ä¾æ—§å¯ä¿æŒå—å†…å®¹çš„åŸå­æ€§ã€‚ 12345678910111213141516171819202122// å†…å­˜ä¸­çš„ç£ç›˜å—ç»“æ„struct buf &#123; int flags; // æ ‡è®°ç£ç›˜çŠ¶æ€ï¼Œvalid/dirty uint dev; // ç£ç›˜è®¾å¤‡å· uint blockno; // å—ç¼–å· struct sleeplock lock; uint refcnt; // å¼•ç”¨è®¡æ•° struct buf *prev; // LRU cache list ä½¿ç”¨LRUæ›¿æ¢ struct buf *next; // é“¾å¼ç»“æ„è¿æ¥ç£ç›˜å— struct buf *qnext; // ç£ç›˜é˜Ÿåˆ— uchar data[BSIZE]; // å—å¤§å°ä¸º512å­—èŠ‚&#125;;// å—ç¼“å†²åŒºç»“æ„struct &#123; struct spinlock lock; struct buf buf[NBUF]; // é€šè¿‡ prev/next è¿æ¥æ‰€æœ‰ç¼“å†²å— // å…¶ä¸­ head.next æ˜¯æœ€è¿‘æœ€å¸¸ä½¿ç”¨çš„å—. struct buf head;&#125; bcache; åˆå§‹åŒ– binitä»ä¸€ä¸ªé™æ€æ•°ç»„bufä¸­æ„å»ºå‡ºä¸€ä¸ªæœ‰NBUFä¸ªå…ƒç´ çš„åŒå‘é“¾è¡¨ã€‚æ‰€æœ‰å¯¹å—ç¼“å†²çš„è®¿é—®éƒ½é€šè¿‡é“¾è¡¨è€Œéé™æ€æ•°ç»„ã€‚ 123456789101112131415161718192021voidbinit(void)&#123; struct buf *b; // åˆå§‹åŒ–å—ç¼“å†²é” initlock(&amp;bcache.lock, \"bcache\");//PAGEBREAK! // æ„å»ºç¼“å†²åŒå‘é“¾è¡¨ bcache.head.prev = &amp;bcache.head; bcache.head.next = &amp;bcache.head; for(b = bcache.buf; b &lt; bcache.buf+NBUF; b++)&#123; b-&gt;next = bcache.head.next; b-&gt;prev = &amp;bcache.head; // åˆå§‹åŒ–ç¼“å†²åŒºä¸­çš„å—çš„é” initsleeplock(&amp;b-&gt;lock, \"buffer\"); bcache.head.next-&gt;prev = b; bcache.head.next = b; &#125;&#125; æŸ¥æ‰¾ bgetæ‰«æç¼“å†²åŒºé“¾è¡¨ï¼Œé€šè¿‡ç»™å®šçš„è®¾å¤‡å·å’Œæ‰‡åŒºå·æ‰¾åˆ°å¯¹åº”çš„ç¼“å†²åŒºã€‚å¦‚æœæœªæ‰¾åˆ°ï¼Œåˆ™åˆ†é…ä¸€ä¸ªç¼“å†²åŒºï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªæŒæœ‰é”çš„ç¼“å†²åŒºã€‚ä»£ç ä¸­åœ¨åŒå‘é“¾è¡¨çš„æœç´¢ä¸­å‘æœ€è¿‘æœ€å¸¸ä½¿ç”¨æ–¹å‘æŸ¥æ‰¾ï¼Œè‹¥æœªæ‰¾åˆ°åˆ™å‘å¦ä¸€æ–¹å‘æŸ¥æ‰¾ç©ºé—²ç¼“å†²åŒºä»¥åˆ†é…ã€‚ å…¶ä¸­è‹¥æ‰¾åˆ°ç¼“å†²åŒºä¸­æŒ‡å®šçš„å—ï¼Œè¿”å›çš„ç»“æœä¹Ÿä¸ä¸€å®šæ˜¯æŒ‡å®šçš„å—ã€‚å› ä¸ºåœ¨è¯·æ±‚è¯¥å—çš„é”å‰å·²é‡Šæ”¾ç¼“å†²åŒºé”ï¼Œè‹¥è¯¥å—æœªæŒæœ‰é”ä¸”æ­£åœ¨è¢«ç”¨æ¥ç¼“å†²å¦å¤–ä¸€ä¸ªå—ï¼Œåˆ™é‡æ–°è·å¾—é”æ—¶å·²æ˜¯å¦ä¸€ä¸ªå—ã€‚ 123456789101112131415161718192021222324252627282930313233343536static struct buf*bget(uint dev, uint blockno)&#123; struct buf *b; acquire(&amp;bcache.lock); // è¯·æ±‚å—ç¼“å†²åŒºé” // ä¸èƒ½ä¿è¯ b ä»ç„¶æ˜¯å¯ç”¨çš„ç¼“å†²åŒºï¼šå®ƒæœ‰å¯èƒ½è¢«ç”¨æ¥ç¼“å†²å¦å¤–ä¸€ä¸ªå—ã€‚ for(b = bcache.head.next; b != &amp;bcache.head; b = b-&gt;next)&#123; if(b-&gt;dev == dev &amp;&amp; b-&gt;blockno == blockno)&#123; b-&gt;refcnt++; // å¼•ç”¨è®¡æ•°åŠ ä¸€ release(&amp;bcache.lock); // é‡Šæ”¾å—ç¼“å†²åŒºé” acquiresleep(&amp;b-&gt;lock); // è¯·æ±‚è¯¥å—çš„é” return b; &#125; &#125; // Not cached; recycle an unused buffer. æœªæ‰¾åˆ°åˆ™é‡æ–°æŸ¥æ‰¾ // Even if refcnt==0, B_DIRTY indicates a buffer is in use // because log.c has modified it but not yet committed it. // å³ä½¿refcntç­‰äº0ï¼Œä¹Ÿå¯é€šè¿‡B_DIRTYçŸ¥é“ç¼“å†²åŒºè¢«ä½¿ç”¨ï¼Œæ­¤æ—¶æ—¥å¿—å·²ä¿®æ”¹ä½†æœªæäº¤ for(b = bcache.head.prev; b != &amp;bcache.head; b = b-&gt;prev)&#123; if(b-&gt;refcnt == 0 &amp;&amp; (b-&gt;flags &amp; B_DIRTY) == 0) &#123; b-&gt;dev = dev; b-&gt;blockno = blockno; b-&gt;flags = 0; b-&gt;refcnt = 1; release(&amp;bcache.lock); acquiresleep(&amp;b-&gt;lock); return b; &#125; &#125; // æœªæ‰¾åˆ°å—ä¸”æœªèƒ½åˆ†é…å—ï¼Œå¼•å‘å†…æ ¸é”™è¯¯ panic(\"bget: no buffers\");&#125; è¯» breadbreadä¼šé¦–å…ˆè°ƒç”¨bgetä»ç¼“å­˜ä¸­å»å¯»æ‰¾å—æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœå­˜åœ¨ç›´æ¥è¿”å›ï¼›å¦‚æœä¸å­˜åœ¨åˆ™è¯·æ±‚ç£ç›˜è¯»æ“ä½œï¼Œè¯»åˆ°ç¼“å­˜ä¸­åå†è¿”å›ç»“æœã€‚ 12345678910111213struct buf*bread(uint dev, uint blockno)&#123; struct buf *b; // è·å–ç¼“å†²åŒº b = bget(dev, blockno); // å¦‚æœç¼“å†²åŒºä¸­ä¸å­˜åœ¨æŒ‡å®šçš„å—ï¼Œåˆ™ä»ç£ç›˜ä¸­è¯»å‡º if((b-&gt;flags &amp; B_VALID) == 0) &#123; iderw(b); &#125; return b;&#125; å†™ bwriteè®¾ç½® B_DIRTY ä½å¹¶ä¸”è°ƒç”¨ iderw å°†ç¼“å†²åŒºçš„å†…å®¹å†™åˆ°ç£ç›˜ã€‚ 123456789voidbwrite(struct buf *b)&#123; // è¯¥å—æœªé”ï¼Œå¯èƒ½å·²è¢«é‡Šæ”¾ï¼Œæ— æ³•å†™å…¥ï¼Œå¼•å‘å†…æ ¸é”™è¯¯ if(!holdingsleep(&amp;b-&gt;lock)) panic(\"bwrite\"); b-&gt;flags |= B_DIRTY; iderw(b);&#125; é‡Šæ”¾ brelseå°†ä¸€å—ç¼“å†²åŒºç§»åŠ¨åˆ°é“¾è¡¨çš„å¤´éƒ¨ï¼Œå”¤é†’ç¡çœ åœ¨è¿™å—ç¼“å†²åŒºä¸Šçš„è¿›ç¨‹ã€‚ 123456789101112131415161718192021222324// å”¤é†’ç¡çœ åœ¨è¿™å—ç¼“å†²åŒºä¸Šçš„è¿›ç¨‹ï¼›å°†ä¸€å—ç¼“å†²åŒºç§»åŠ¨åˆ°é“¾è¡¨çš„å¤´éƒ¨ã€‚voidbrelse(struct buf *b)&#123; // ç¼“å†²åŒºæœªæŒæœ‰å—é”ï¼Œå¼•å‘å†…æ ¸é”™è¯¯ if(!holdingsleep(&amp;b-&gt;lock)) panic(\"brelse\"); releasesleep(&amp;b-&gt;lock); // é‡Šæ”¾å—é” acquire(&amp;bcache.lock); // è¯·æ±‚ ç¼“å†²åŒºé” b-&gt;refcnt--; //å¼•ç”¨è®¡æ•°å‡ä¸€ if (b-&gt;refcnt == 0) &#123; // æ— è¿›ç¨‹ç­‰å¾…ä½¿ç”¨ï¼Œç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ b-&gt;next-&gt;prev = b-&gt;prev; b-&gt;prev-&gt;next = b-&gt;next; b-&gt;next = bcache.head.next; b-&gt;prev = &amp;bcache.head; bcache.head.next-&gt;prev = b; bcache.head.next = b; &#125; release(&amp;bcache.lock); //é‡Šæ”¾ç¼“å†²åŒºé”&#125; æ—¥å¿—å±‚æ¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨éƒ½å¯èƒ½åŒ…å«ä¸€ä¸ªå¿…é¡»ä»å¤´åˆ°å°¾åŸå­å®Œæˆçš„å†™æ“ä½œåºåˆ—ï¼Œç§°è¿™æ ·çš„ä¸€ä¸ªåºåˆ—ä¸ºä¸€ä¸ªä¼šè¯ã€‚ä»»ä½•æ—¶å€™åªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨ä¸€ä¸ªä¼šè¯ä¹‹ä¸­ï¼Œå…¶ä»–è¿›ç¨‹å¿…é¡»ç­‰å¾…å½“å‰ä¼šè¯ä¸­çš„è¿›ç¨‹ç»“æŸã€‚å› æ­¤åŒä¸€æ—¶åˆ»æ—¥å¿—æœ€å¤šåªè®°å½•ä¸€æ¬¡ä¼šè¯ã€‚ è¯¥å±‚ç”¨äºç»´æŠ¤ç³»ç»Ÿå´©æºƒååˆ°åŸå­æ€§ï¼Œå³ä¼šè¯è¦ä¹ˆå®Œæˆï¼Œè¦ä¹ˆç³»ç»Ÿæ¢å¤è‡³ä¼šè¯å¼€å§‹å‰çš„çŠ¶æ€ã€‚ å—åˆ†é…å™¨æœ¬éƒ¨åˆ†æ¶‰åŠçš„å‡½æ•°ä½äºfs.cã€‚ ç”±äºbreadä¸brelseå·²æœ‰é”è¿›è¡Œäº’æ–¥ï¼Œå—åˆ†é…å™¨æ— éœ€å†åŠ é”ã€‚ åˆ†é…æ–°çš„ç£ç›˜å—123456789101112131415161718192021222324static uintballoc(uint dev)&#123; int b, bi, m; struct buf *bp; bp = 0; for(b = 0; b &lt; sb.size; b += BPB)&#123; // è¯»ä½å›¾æ¯ä¸€å— bp = bread(dev, BBLOCK(b, sb)); for(bi = 0; bi &lt; BPB &amp;&amp; b + bi &lt; sb.size; bi++)&#123; // è¯»å—å†…æ¯ä¸€ä½ m = 1 &lt;&lt; (bi % 8); if((bp-&gt;data[bi/8] &amp; m) == 0)&#123; // åˆ¤æ–­å—æ˜¯å¦ç©ºé—² bp-&gt;data[bi/8] |= m; // å°†å—æ ‡è®°ä¸ºä½¿ç”¨ä¸­ log_write(bp); brelse(bp); // é‡Šæ”¾å— bzero(dev, b + bi); // æ¸…é›¶å— return b + bi; &#125; &#125; brelse(bp); &#125; // è¶…å‡ºå—èŒƒå›´ï¼Œå¼•å‘é”™è¯¯ panic(\"balloc: out of blocks\");&#125; é‡Šæ”¾ç£ç›˜å—12345678910111213141516static voidbfree(int dev, uint b)&#123; struct buf *bp; int bi, m; readsb(dev, &amp;sb); bp = bread(dev, BBLOCK(b, sb)); bi = b % BPB; m = 1 &lt;&lt; (bi % 8); if((bp-&gt;data[bi/8] &amp; m) == 0) // é‡Šæ”¾ç©ºé—²å—ï¼Œé”™è¯¯ panic(\"freeing free block\"); bp-&gt;data[bi/8] &amp;= ~m; log_write(bp); brelse(bp); // é‡Šæ”¾å—&#125; inodeinodeæœ‰ä¸¤ç§ç±»åˆ«ï¼š ç£ç›˜ä¸Šçš„è®°å½•æ–‡ä»¶å¤§å°ã€æ•°æ®å—æ‰‡åŒºå·çš„æ•°æ®ç»“æ„ 12345678struct dinode &#123; short type; // åŒºåˆ†æ–‡ä»¶ã€ç›®å½•å’Œç‰¹æ®Šæ–‡ä»¶çš„ i èŠ‚ç‚¹ï¼Œ0è¡¨ç¤ºä¸ºç©ºé—²èŠ‚ç‚¹ short major; // ä¸»è®¾å¤‡å·ï¼ˆä»…é™T_DEVï¼‰ short minor; // è¾…è®¾å¤‡å·ï¼ˆä»…é™T_DEVï¼‰ short nlink; // æ–‡ä»¶ç³»ç»Ÿä¸­çš„ièŠ‚ç‚¹è¿æ¥æ•° uint size; // æ–‡ä»¶çš„å­—èŠ‚æ•° uint addrs[NDIRECT+1]; // ç”¨äºè¿™ä¸ªæ–‡ä»¶çš„æ•°æ®å—çš„å—å·&#125;; å†…å­˜ä¸­çš„ä¸€ä¸ª i èŠ‚ç‚¹ï¼ŒåŒ…å«ä¸€ä¸ªç£ç›˜ä¸Š i èŠ‚ç‚¹çš„æ‹·è´ï¼Œä»¥åŠä¸€äº›å†…æ ¸éœ€è¦çš„é™„åŠ ä¿¡æ¯ 123456789101112131415struct inode &#123; uint dev; // Device number è®¾å¤‡å· uint inum; // Inode number inodeå· int ref; // Reference count å¼•ç”¨æ•° struct sleeplock lock; // protects everything below here ä¿æŠ¤ä»¥ä¸‹æ‰€æœ‰æ•°æ® int valid; // inode has been read from disk? ièŠ‚ç‚¹æ˜¯å¦å·²ä»ç£ç›˜ä¸­è¯»å– // ä»¥ä¸‹å‡ä¸ºç£ç›˜ä¸Šçš„ièŠ‚ç‚¹ï¼Œå³dinodeï¼Œçš„æ‹·è´ short type; // copy of disk inode short major; short minor; short nlink; uint size; uint addrs[NDIRECT+1];&#125;; xv6ä¸­æœ‰inodeçš„ç¼“å†²åŒºï¼Œä½œç”¨ä¸å—ç¼“å†²åŒºç›¸ä¼¼ã€‚ä»¥ä¸‹å‡½æ•°åˆ†æä»…åŒ…å«è¿›è¡Œç‰¹æ®Šæ“ä½œæˆ–è¾ƒä¸ºå¤æ‚çš„å‡½æ•°ï¼Œå…¶ä½™å‡½æ•°ä»…å†™å‡ºä½œç”¨å’Œä½¿ç”¨æ¡ä»¶ï¼ˆå¦‚iunlockï¼‰ã€‚å…¶ä¸­å‡½æ•°ä½äºfs.cã€‚ è·å–inode igetigetè¿”å›çš„inodeçš„æŒ‡é’ˆå°†ä¿è¯è¿™ä¸ªinodeä¼šç•™åœ¨ç¼“å­˜ä¸­ï¼Œä¸ä¼šè¢«åˆ æ‰ä¸”ä¸ä¼šè¢«ç”¨äºç¼“å­˜å¦ä¸€ä¸ªæ–‡ä»¶ï¼ˆå³ä½¿æœªè¯»å…¥ç£ç›˜dinodeå†…å®¹ï¼‰ã€‚è‹¥ç£ç›˜å†…å®¹æœªè¯»å…¥ï¼Œåˆ™ä»¥ååœ¨è°ƒç”¨ilockæ—¶è¯»å…¥ã€‚ å…¶ä¸­igetè¿”å›çš„inodeçš„æ˜¯æœªè¢«é”çš„ã€‚åœ¨ç›®å½•å±‚çš„ç›®å½•æŸ¥æ‰¾ä¸­ï¼Œè°ƒç”¨è€…å·²ç»å¯¹dpä¸Šé”ï¼Œå¦‚æœåœ¨è°ƒç”¨igetè¿”å›ä¹‹å‰å°è¯•å»é”ä¸Šè¯¥ièŠ‚ç‚¹ä¼šæœ‰äºŒæ¬¡é”ä¸Šdpçš„å¯èƒ½ä»è€Œé€ æˆæ­»é”ã€‚ 1234567891011121314151617181920212223242526272829303132static struct inode*iget(uint dev, uint inum)&#123; struct inode *ip, *empty; acquire(&amp;icache.lock); // åœ¨inodeçš„cacheä¸­å¯»æ‰¾ç›®æ ‡inode empty = 0; for(ip = &amp;icache.inode[0]; ip &lt; &amp;icache.inode[NINODE]; ip++)&#123; if(ip-&gt;ref &gt; 0 &amp;&amp; ip-&gt;dev == dev &amp;&amp; ip-&gt;inum == inum)&#123; ip-&gt;ref++; release(&amp;icache.lock); return ip; // æ­¤æ—¶è¿”å›çš„ièŠ‚ç‚¹å†…å®¹ä¸ä¸€å®šå·²ä»ç£ç›˜è¯»å…¥cache &#125; if(empty == 0 &amp;&amp; ip-&gt;ref == 0) // è®°å½•æ‰«æåˆ°çš„ç¬¬ä¸€ä¸ªç©ºæ§½ empty = ip; &#125; // ä¿æŒinodeå…¥å£ï¼Œä»¥ä¸‹æœªä»ç£ç›˜è¯»å…¥å†…å®¹ if(empty == 0) // cacheä¸­æ— ièŠ‚ç‚¹ç©ºé—²ï¼Œå‡ºé”™ panic(\"iget: no inodes\"); ip = empty; ip-&gt;dev = dev; ip-&gt;inum = inum; ip-&gt;ref = 1; ip-&gt;valid = 0; release(&amp;icache.lock); return ip;&#125; åˆ†é…inode iallocåœ¨è®¾å¤‡devä¸Šåˆ†é…inodeï¼šé€šè¿‡ç»™å®ƒç±»å‹ç±»å‹å°†å…¶æ ‡è®°ä¸ºå·²åˆ†é…ï¼Œè¿”å›æœªé”å®šä½†å·²åˆ†é…å’Œå¼•ç”¨çš„inodeã€‚è¿™é‡Œä¸ballocç›¸ä¼¼ï¼Œå¯å‚ç…§å‰æ–‡ã€‚ 123456789101112131415161718192021struct inode*ialloc(uint dev, short type)&#123; int inum; struct buf *bp; struct dinode *dip; for(inum = 1; inum &lt; sb.ninodes; inum++)&#123; bp = bread(dev, IBLOCK(inum, sb)); dip = (struct dinode*)bp-&gt;data + inum%IPB; if(dip-&gt;type == 0)&#123; // inodeæœªåˆ†é… memset(dip, 0, sizeof(*dip)); // åˆ†é…ç©ºé—´ dip-&gt;type = type; log_write(bp); brelse(bp); return iget(dev, inum); &#125; brelse(bp); &#125; panic(\"ialloc: no inodes\");&#125; é”inode ilocké”å®šç»™å®šçš„inodeã€‚å¦‚æœ‰å¿…è¦ï¼Œä»ç£ç›˜è¯»å–inodeã€‚ 1234567891011121314151617181920212223242526voidilock(struct inode *ip)&#123; struct buf *bp; struct dinode *dip; if(ip == 0 || ip-&gt;ref &lt; 1) panic(\"ilock\"); acquiresleep(&amp;ip-&gt;lock); // è¯·æ±‚inodeé” if(ip-&gt;valid == 0)&#123; // inodeå†…å®¹æœªä»ç£ç›˜è¯»å– bp = bread(ip-&gt;dev, IBLOCK(ip-&gt;inum, sb)); dip = (struct dinode*)bp-&gt;data + ip-&gt;inum%IPB; ip-&gt;type = dip-&gt;type; ip-&gt;major = dip-&gt;major; ip-&gt;minor = dip-&gt;minor; ip-&gt;nlink = dip-&gt;nlink; ip-&gt;size = dip-&gt;size; memmove(ip-&gt;addrs, dip-&gt;addrs, sizeof(ip-&gt;addrs)); brelse(bp); ip-&gt;valid = 1; if(ip-&gt;type == 0) // inodeæœªè¢«åˆ†é…ï¼Œå‡ºé”™ï¼Œå¼•å‘ææ…Œ panic(\"ilock: no type\"); &#125;&#125; é‡Šæ”¾å¼•ç”¨ iputé‡Šæ”¾å¯¹å†…å­˜ä¸­çš„æŸä¸€inodeçš„å¼•ç”¨ï¼Œå³å¼•ç”¨æ•°å‡ä¸€ã€‚å¯¹iputï¼ˆï¼‰çš„æ‰€æœ‰è°ƒç”¨å¿…é¡»åœ¨ä¼šè¯å†…ï¼Œå› ä¸ºå®ƒå¯èƒ½é‡Šæ”¾inodeã€‚ 123456789101112131415161718192021222324voidiput(struct inode *ip)&#123; acquiresleep(&amp;ip-&gt;lock); // è¯·æ±‚inodeé” // å¦‚æœè¿™æ˜¯æœ€åä¸€ä¸ªå¼•ç”¨ï¼Œåˆ™å¯ä»¥å›æ”¶inodeç¼“å­˜æ¡ç›®ã€‚ if(ip-&gt;valid &amp;&amp; ip-&gt;nlink == 0)&#123; acquire(&amp;icache.lock); int r = ip-&gt;ref; release(&amp;icache.lock); if(r == 1)&#123; // inode has no links and no other references: truncate and free. // å¦‚æœé‚£æ˜¯æœ€åä¸€ä¸ªå¼•ç”¨å¹¶ä¸”inodeæ²¡æœ‰è¿æ¥ï¼Œé‡Šæ”¾ç£ç›˜ä¸Šçš„inodeï¼ˆåŠå…¶å†…å®¹ï¼‰ã€‚ itrunc(ip); ip-&gt;type = 0; iupdate(ip); ip-&gt;valid = 0; &#125; &#125; releasesleep(&amp;ip-&gt;lock); // é‡Šæ”¾ inode é” acquire(&amp;icache.lock); ip-&gt;ref--; // å¼•ç”¨è®¡æ•°å‡ä¸€ release(&amp;icache.lock);&#125; å…¶ä»–å‡½æ•° readsb è¯»è¶…çº§å— bzero å°†å—å†…å®¹æ¸…é›¶ iupdate å°†ä¿®æ”¹åçš„å†…å­˜ä¸­inodeå¤åˆ¶åˆ°ç£ç›˜ï¼›å¿…é¡»åœ¨æ¯æ¬¡æ›´æ”¹ip-&gt; xxxå­—æ®µåè°ƒç”¨ï¼›å®ƒå­˜åœ¨äºç£ç›˜ä¸Šï¼Œå› ä¸ºi-nodeç¼“å­˜æ˜¯ç›´å†™å¼çš„ï¼›è°ƒç”¨è€…å¿…é¡»æŒæœ‰ièŠ‚ç‚¹é”ã€‚ iunlock å¯¹æŒ‡å®šinodeè§£é” iunlockput iunlockå’Œiputçš„ç»“åˆã€‚ç”±äºä¸¤ç§å¸¸å¸¸ä¸€èµ·ä½¿ç”¨ï¼Œæ•…æ•´åˆã€‚ bmap è¿”å›inodeä¸­ç¬¬nä¸ªå—çš„ç£ç›˜å—åœ°å€ï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„å—ï¼Œbmapä¼šåˆ†é…ä¸€ä¸ªã€‚ stati ä»inodeå¤åˆ¶å±æ€§ä¿¡æ¯ã€‚ readi ä»inodeè¯»æ•°æ®ï¼Œè°ƒç”¨è€…å¿…é¡»æŒæœ‰ip-&gt; lockã€‚ writei ç»™inodeå†™å…¥æ•°æ®ï¼Œè°ƒç”¨è€…å¿…é¡»æŒæœ‰ip-&gt; lockã€‚ å…¶ä¸­readiå’Œwriteiå‡è¦æ±‚ç»™å®šçš„åç§»å’Œè¯»å‡ºçš„é‡ä¸è¶…å‡ºæ–‡ä»¶å¤§å°ã€‚ ç›®å½•å±‚æ•°æ®ç»“æ„ç›®å½•çš„ièŠ‚ç‚¹çš„ç±»å‹æ˜¯T_DIR,.ç›®å½•æœ¬èº«æ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨åˆ°ç£ç›˜ä¸Šçš„ï¼Œå®ƒçš„æ•°æ®æ˜¯ä¸€ç³»åˆ—çš„ç›®å½•æ¡ç›®ã€‚ 1234struct dirent &#123; ushort inum; // ièŠ‚ç‚¹å· char name[DIRSIZ]; // ç›®å½•å&#125;; å‡½æ•°è¯¦ç»†æ³¨é‡Šä½äºfs.cã€‚ dirlookup æŸ¥æ‰¾ç›®å½•ä¸­æŒ‡å®šåå­—çš„æ¡ç›® dirlink ä¼šå†™å…¥ä¸€ä¸ªæ–°çš„ç›®å½•æ¡ç›®åˆ°æŸä¸€ç›®å½•ä¸‹ è·¯å¾„å‡½æ•° namex æŸ¥æ‰¾å¹¶è¿”å›inodeä»¥è·å–è·¯å¾„åã€‚å¦‚æœparentï¼= 0ï¼Œåˆ™è¿”å›çˆ¶é¡¹çš„inodeå¹¶å¤åˆ¶æœ€ç»ˆé¡¹ã€‚è·¯å¾„å…ƒç´ åˆ°åç§°ï¼Œå¿…é¡»æœ‰DIRSIZå­—èŠ‚çš„ç©ºé—´ã€‚è¯¥å‡½æ•°å¿…é¡»åœ¨ä¼šè¯å†…éƒ¨è°ƒç”¨ï¼Œå› ä¸ºå®ƒè°ƒç”¨iputï¼ˆï¼‰ã€‚ 1234567891011121314151617181920212223242526272829303132333435static struct inode*namex(char *path, int nameiparent, char *name)&#123; struct inode *ip, *next; if(*path == '/') // è·¯å¾„ä»¥åæ–œæ å¼€å§‹ï¼Œåˆ™è§£æä»æ ¹ç›®å½•å¼€å§‹ ip = iget(ROOTDEV, ROOTINO); else // å…¶ä»–æƒ…å†µä¸‹åˆ™ä»å½“å‰ç›®å½•å¼€å§‹ ip = idup(myproc()-&gt;cwd); while((path = skipelem(path, name)) != 0)&#123; // è€ƒè™‘è·¯å¾„ä¸­çš„æ¯ä¸€ä¸ªéƒ¨åˆ† ilock(ip); // ç¡®ä¿ip-&gt;typeä»ç£ç›˜ä¸­åŠ è½½å‡ºæ¥ if(ip-&gt;type != T_DIR)&#123; // ä¸æ˜¯ç›®å½•ï¼ŒæŸ¥æ‰¾å¤±è´¥ iunlockput(ip); return 0; &#125; // æœ€åä¸€ä¸ªè·¯å¾„å…ƒç´ ï¼Œå¾ªç¯æå‰ç»“æŸ if(nameiparent &amp;&amp; *path == '\\0')&#123; // Stop one level early. iunlock(ip); return ip; &#125; if((next = dirlookup(ip, name, 0)) == 0)&#123; // å¯»æ‰¾è·¯å¾„å…ƒç´ å¤±è´¥ï¼ŒæŸ¥æ‰¾å¤±è´¥ iunlockput(ip); return 0; &#125; iunlockput(ip); ip = next; &#125; if(nameiparent)&#123; iput(ip); return 0; &#125; return ip;&#125; skipelem å°†è·¯å¾„ä¸­çš„ä¸‹ä¸€ä¸ªè·¯å¾„å…ƒç´ å¤åˆ¶åˆ°åç§°ä¸­ï¼Œè¿”å›æŒ‡å‘å¤åˆ¶åçš„å…ƒç´ çš„æŒ‡é’ˆã€‚ namei è§£æpathå¹¶è¿”å›å¯¹åº”çš„inodeã€‚ nameiparent è¿”å›ä¸Šçº§ç›®å½•çš„ièŠ‚ç‚¹å¹¶ä¸”æŠŠæœ€åä¸€ä¸ªå…ƒç´ æ‹·è´åˆ°nameä¸­ã€‚ å‡½æ•°çš„è¯¦ç»†å†…å®¹ä½äºfs.c æ–‡ä»¶æè¿°ç¬¦å±‚123456789struct file &#123; enum &#123; FD_NONE, FD_PIPE, FD_INODE &#125; type; // æ–‡ä»¶åˆ†ä¸ºç®¡é“æ–‡ä»¶å’Œæ™®é€šæ–‡ä»¶ç­‰ï¼ŒFD_NONEè¡¨ç¤ºæ–‡ä»¶æœªä½¿ç”¨ int ref; // reference count å¼•ç”¨è®¡æ•° char readable; // å¯è¯» char writable; // å¯å†™ struct pipe *pipe; // ç®¡é“ struct inode *ip; // æŒ‡å‘ièŠ‚ç‚¹ uint off;&#125;; xv6ä¸­æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„æ‰“å¼€æ–‡ä»¶è¡¨ã€‚æ¯ä¸ªæ‰“å¼€æ–‡ä»¶å‡ç”±ä¸Šé¢çš„ç»“æ„ä½“è¡¨ç¤ºï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹ièŠ‚ç‚¹æˆ–è€…ç®¡é“å’Œæ–‡ä»¶åç§»çš„å°è£…ã€‚æ¯æ¬¡è°ƒç”¨openéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„fileç»“æ„ä½“ã€‚ å¦‚æœå¤šä¸ªè¿›ç¨‹ç›¸äº’ç‹¬ç«‹åœ°æ‰“å¼€äº†åŒä¸€ä¸ªæ–‡ä»¶ï¼Œä¸åŒçš„å®ä¾‹å°†æ‹¥æœ‰ä¸åŒçš„I/Oåç§»ã€‚è€Œä¸”åŒä¸€ä¸ªfileç»“æ„ä½“å¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹çš„æ–‡ä»¶è¡¨ä¸­å¤šæ¬¡å‡ºç°ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åœ¨å¤šä¸ªè¿›ç¨‹çš„æ–‡ä»¶è¡¨ä¸­å‡ºç°ã€‚å¯¹æ¯ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°ï¼Œä¸€ä¸ªæ–‡ä»¶å¯ä»¥è¢«æ‰“å¼€ç”¨äºè¯»ã€å†™æˆ–è€…äºŒè€…ã€‚ ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ‰“å¼€æ–‡ä»¶éƒ½å­˜åœ¨äºä¸€ä¸ªå…¨å±€çš„æ–‡ä»¶è¡¨ftableä¸­ã€‚ å‡½æ•°è¯¥å±‚çš„å‡½æ•°ä½äºfile.cï¼Œè¯¦ç»†æ³¨é‡Šè§ä»£ç æ–‡ä»¶ã€‚ filealloc åˆ†é…æ–‡ä»¶ï¼Œæ‰«ææ•´ä¸ªæ–‡ä»¶è¡¨å¯»æ‰¾æ²¡æœ‰è¢«å¼•ç”¨çš„æ–‡ä»¶å¹¶è¿”å›ä¸€ä¸ªæ–°çš„å¼•ç”¨ã€‚ filedup é‡å¤å¼•ç”¨æ–‡ä»¶ï¼Œå¢åŠ å¼•ç”¨è®¡æ•°ã€‚ fileclose é‡Šæ”¾å¯¹æ–‡ä»¶å¼•ç”¨çš„å‡½æ•°ï¼Œå‡å°‘å¼•ç”¨è®¡æ•°ï¼Œå½“ä¸€ä¸ªæ–‡ä»¶çš„å¼•ç”¨è®¡æ•°å˜ä¸º0çš„æ—¶å€™ï¼Œæ ¹æ®æ–‡ä»¶ç±»å‹çš„ä¸åŒ,é‡Šæ”¾æ‰å½“å‰çš„ç®¡é“æˆ–è€…ièŠ‚ç‚¹ã€‚ fileread è¯»æ–‡ä»¶ï¼Œå®ç°å¯¹æ–‡ä»¶çš„readæ“ä½œ filewrite å†™æ–‡ä»¶ï¼Œå®ç°å¯¹æ–‡ä»¶çš„writeæ“ä½œã€‚ filestat è·å–æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼Œå®ç°å¯¹æ–‡ä»¶çš„statæ“ä½œï¼ˆåªå…è®¸ä½œç”¨åœ¨inodeï¼‰ã€‚ ç³»ç»Ÿè°ƒç”¨æš‚æ— å†…å®¹ã€‚ æ–‡ä»¶ç³»ç»Ÿä¸­xv6å¯æ”¹è¿›ä¹‹å¤„cache ä½¿ç”¨çš„æ›¿æ¢ç­–ç•¥ä¸ºLRUï¼Œç®—æ³•è¾ƒä¸ºç®€å•ã€‚ é“¾è¡¨çš„ä½¿ç”¨è™½ç„¶å®ç°ç®€å•ï¼Œä½†æŸ¥æ‰¾æ•ˆç‡ä½ï¼Œæ—¶é—´å¤æ‚åº¦é«˜ã€‚è‹¥èƒ½ä½¿ç”¨å“ˆå¸Œè¡¨ç­‰å®ç°æŸ¥æ‰¾å¯æé«˜æ•ˆç‡ã€‚ ç›®å½•æŸ¥æ‰¾ç›®å½•æŸ¥æ‰¾ä¸ºçº¿æ€§æŸ¥æ‰¾ï¼Œåœ¨ç›®å½•æ•°é‡è¾ƒå¤šçš„æƒ…å†µä¸‹è€—æ—¶å·¨å¤§ã€‚è‹¥èƒ½ä½¿ç”¨æ ‘ç­‰ç»“æ„ï¼Œä¾¿èƒ½å¤§å¤§å‡å°æ—¶é—´å¤æ‚åº¦ã€‚ å¤§å°å›ºå®šæ–‡ä»¶ç³»ç»Ÿçš„å¤§å°åœ¨xv6ä¸­æ˜¯ä¸æ”¹å˜çš„ï¼Œå›ºå®šåœ¨ä¸€ä¸ªç£ç›˜è®¾å¤‡ä¸Šã€‚è¿™ä¸€ç‚¹å¯¹äºä¸ªäººPCå½±å“ä¸å¤§ï¼Œä½†åœ¨éœ€è¦å­˜å‚¨å¤§é‡æ–‡ä»¶æˆ–è¶…å¤§æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œä¾¿æœ‰äº›æ‰è¥Ÿè§è‚˜ã€‚","categories":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"http://rootreturn0.github.io/categories/æ“ä½œç³»ç»Ÿ/"}],"tags":[{"name":"å­¦ä¹ ","slug":"å­¦ä¹ ","permalink":"http://rootreturn0.github.io/tags/å­¦ä¹ /"}]},{"title":"å»ºç«™åˆå§‹æ—¥å¿—","slug":"å»ºç«™åˆå§‹æ—¥å¿—","date":"2019-07-26T06:00:02.000Z","updated":"2019-10-18T17:48:45.597Z","comments":true,"path":"2019/07/26/å»ºç«™åˆå§‹æ—¥å¿—/","link":"","permalink":"http://rootreturn0.github.io/2019/07/26/å»ºç«™åˆå§‹æ—¥å¿—/","excerpt":"ä¸»é¢˜Nextä¸€å¼€å§‹é€‰ç”¨çš„æ˜¯Yilia,ä½†ç”±äºYiliaå¼€å‘ä½¿ç”¨çš„webpackç‰ˆæœ¬è¾ƒè€ï¼Œå®šåˆ¶æ—¶æ˜“è¸©å‘ï¼Œæ•…æ”¹ç”¨Nextã€‚æœ¬æ–‡æ ¹æ®å®˜æ–¹æ–‡æ¡£æ•´ç†ï¼Œå¹¶æ ¹æ®è‡ªå·±å–œå¥½åŠ å…¥äº†ä¸€äº›ç¬¬ä¸‰æ–¹æ’ä»¶å’Œä¿®æ”¹ã€‚æ‰€æœ‰ä¿®æ”¹å°†ä¼šé€æ­¥ç»™å‡ºï¼ŒNextçš„é…ç½®å®Œæ•´è¯´æ˜å¯å‚ç…§å®˜æ–¹æ–‡æ¡£ã€‚","text":"ä¸»é¢˜Nextä¸€å¼€å§‹é€‰ç”¨çš„æ˜¯Yilia,ä½†ç”±äºYiliaå¼€å‘ä½¿ç”¨çš„webpackç‰ˆæœ¬è¾ƒè€ï¼Œå®šåˆ¶æ—¶æ˜“è¸©å‘ï¼Œæ•…æ”¹ç”¨Nextã€‚æœ¬æ–‡æ ¹æ®å®˜æ–¹æ–‡æ¡£æ•´ç†ï¼Œå¹¶æ ¹æ®è‡ªå·±å–œå¥½åŠ å…¥äº†ä¸€äº›ç¬¬ä¸‰æ–¹æ’ä»¶å’Œä¿®æ”¹ã€‚æ‰€æœ‰ä¿®æ”¹å°†ä¼šé€æ­¥ç»™å‡ºï¼ŒNextçš„é…ç½®å®Œæ•´è¯´æ˜å¯å‚ç…§å®˜æ–¹æ–‡æ¡£ã€‚ åŸºæœ¬é…ç½®ä¸‹è½½12cd åšå®¢æ ¹ç›®å½•git clone https://github.com/iissnan/hexo-theme-next themes/next å¯ç”¨æ‰“å¼€æ ¹ç›®å½•ä¸­çš„ _config.yml æ–‡ä»¶,æ›´æ”¹ theme ä¸º next ã€‚ 1234# Extensions## Plugins: https://hexo.io/plugins/## Themes: https://hexo.io/themes/theme: next é€‰æ‹©Schemeæ‰“å¼€ theme/next ä¸­çš„ _config.yml æ–‡ä»¶ï¼Œé€‰æ‹© Muse ã€‚ 12345# Schemesscheme: Muse#scheme: Mist#scheme: Pisces#scheme: Gemini åˆ‡æ¢è¯­è¨€æ‰“å¼€æ ¹ç›®å½•ä¸­çš„ _config.yml æ–‡ä»¶,è®¾ç½® language ä¸º zh-Hans ã€‚ è‡ªå®šä¹‰ä¸»é¡µæ–‡ç« é˜´å½±æ•ˆæœæ‰“å¼€ themes/next/source/css/_custom/custom.styl ,å¢åŠ  12345678// ä¸»é¡µæ–‡ç« æ·»åŠ é˜´å½±æ•ˆæœ .post &#123; margin-top: 60px; margin-bottom: 60px; padding: 25px; -webkit-box-shadow: 0 0 5px rgba(202, 203, 203, .5); -moz-box-shadow: 0 0 5px rgba(202, 203, 204, .5); &#125; ä¿®æ”¹æ ‡ç­¾æ‰“å¼€ themes/next/layout/_macro/post.swig ï¼Œæœç´¢ rel=&quot;tag&quot;&gt;#ï¼Œå°† # æ¢æˆ &lt;i class=&quot;fa fa-tag&quot;&gt;&lt;/i&gt; ã€‚ åŠ¨æ€èƒŒæ™¯æ‰“å¼€ theme/next/layout/_layout.swig ï¼Œåœ¨ &lt; /body&gt;ä¹‹å‰æ·»åŠ ä»£ç  123&#123;% if theme.canvas_nest %&#125;&lt;script type=\"text/javascript\" src=\"//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js\"&gt;&lt;/script&gt;&#123;% endif %&#125; æ‰“å¼€ theme/next ä¸­çš„ _config.yml æ–‡ä»¶,å°† canvas_next ç½®ä¸º true ã€‚ 1canvas_nest: true çœ‹æ¿ç‹—å®‰è£… 12npm install hexo-helper-live2d --savenpm install live2d-widget-model-wanko æ‰“å¼€æ ¹ç›®å½•ä¸­çš„ _config.yml æ–‡ä»¶,å¢åŠ ä»¥ä¸‹ä»£ç ã€‚å…¶ä¸­å¯¹ display éƒ¨åˆ†åšäº†ä¿®æ”¹ï¼Œä»¥é€‚åº”ç½‘é¡µå¸ƒå±€ã€‚ 1234567891011121314151617181920212223242526272829# Live2D## https://github.com/EYHN/hexo-helper-live2dlive2d: enable: true # enable: false scriptFrom: local # é»˜è®¤ pluginRootPath: live2dw/ # æ’ä»¶åœ¨ç«™ç‚¹ä¸Šçš„æ ¹ç›®å½•(ç›¸å¯¹è·¯å¾„) pluginJsPath: lib/ # è„šæœ¬æ–‡ä»¶ç›¸å¯¹ä¸æ’ä»¶æ ¹ç›®å½•è·¯å¾„ pluginModelPath: assets/ # æ¨¡å‹æ–‡ä»¶ç›¸å¯¹ä¸æ’ä»¶æ ¹ç›®å½•è·¯å¾„ # scriptFrom: jsdelivr # jsdelivr CDN # scriptFrom: unpkg # unpkg CDN # scriptFrom: https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js # ä½ çš„è‡ªå®šä¹‰ url tagMode: false # æ ‡ç­¾æ¨¡å¼, æ˜¯å¦ä»…æ›¿æ¢ live2d tagæ ‡ç­¾è€Œéæ’å…¥åˆ°æ‰€æœ‰é¡µé¢ä¸­ debug: false # è°ƒè¯•, æ˜¯å¦åœ¨æ§åˆ¶å°è¾“å‡ºæ—¥å¿— model: use: live2d-widget-model-wanko # npm-module package name # use: wanko # åšå®¢æ ¹ç›®å½•/live2d_models/ ä¸‹çš„ç›®å½•å # use: ./wives/wanko # ç›¸å¯¹äºåšå®¢æ ¹ç›®å½•çš„è·¯å¾„ # use: https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json # ä½ çš„è‡ªå®šä¹‰ url display: position: right width: 200 height: 400 # æ°´å¹³ä½ç½® hOffset: 40 # å‚ç›´ä½ç½® vOffset: -80 mobile: show: true # æ‰‹æœºä¸­æ˜¯å¦å±•ç¤º Github Cornersæ‰“å¼€Github Corners,å¤åˆ¶ä»£ç å¹¶ç²˜è´´ä»£ç åˆ° themes/next/layout/_layout.swig æ–‡ä»¶ä¸­(æ”¾åœ¨ &lt;div class=&quot;headband&quot;&gt;&lt;/div&gt; çš„ä¸‹é¢)ï¼Œå¹¶æŠŠ href æ”¹ä¸ºæ­£ç¡®çš„githubåœ°å€ã€‚ ç”±äºæ¯”è¾ƒå–œæ¬¢è¿™ä¸ªå°å®¶ä¼™ä¸€ç›´å‡ºç°ï¼Œæ•…æ›´æ”¹ä»£ç ä¸­çš„ position: absolute ä¸º position: fixed ã€‚ 123&lt;div class=\"headband\"&gt;&lt;/div&gt;&lt;a href=\"https://github.com/RootReturn0\" class=\"github-corner\" aria-label=\"View source on GitHub\"&gt;&lt;svg width=\"80\" height=\"80\" viewBox=\"0 0 250 250\" style=\"fill:#151513; color:#fff; position: fixed; top: 0; border: 0; right: 0;\" aria-hidden=\"true\"&gt;&lt;path d=\"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z\"&gt;&lt;/path&gt;&lt;path d=\"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2\" fill=\"currentColor\" style=\"transform-origin: 130px 106px;\" class=\"octo-arm\"&gt;&lt;/path&gt;&lt;path d=\"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z\" fill=\"currentColor\" class=\"octo-body\"&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;style&gt;.github-corner:hover .octo-arm&#123;animation:octocat-wave 560ms ease-in-out&#125;@keyframes octocat-wave&#123;0%,100%&#123;transform:rotate(0)&#125;20%,60%&#123;transform:rotate(-25deg)&#125;40%,80%&#123;transform:rotate(10deg)&#125;&#125;@media (max-width:500px)&#123;.github-corner:hover .octo-arm&#123;animation:none&#125;.github-corner .octo-arm&#123;animation:octocat-wave 560ms ease-in-out&#125;&#125;&lt;/style&gt; RSS12cd åšå®¢æ ¹ç›®å½•npm install hexo-generator-feed --save æ‰“å¼€æ ¹ç›®å½•ä¸­çš„ _config.yml æ–‡ä»¶,æ·»åŠ  123# Extensions## Plugins: http://hexo.io/plugins/plugins: hexo-generate-feed æ‰“å¼€ theme/next ä¸­çš„ _config.yml æ–‡ä»¶,åœ¨ rss åæ·»åŠ  /atom.xml 1234# Set rss to false to disable feed link.# Leave rss as empty to use site's feed link.# Set rss to specific value if you have burned your feed already.rss: /atom.xml åŠ å¯†æœ‰æ—¶å†™åšå®¢å¹¶ä¸å¸Œæœ›è®©æ‰€æœ‰äººçœ‹åˆ°ï¼Œæ•…åŠ å…¥äº†åŠ å¯†åŠŸèƒ½ã€‚Hexoæ˜¯ä¸€ä¸ªé™æ€åšå®¢ï¼Œè‡ªå·±å†™ä¸€ä¸ªjsè¿›è¡ŒåŠ å¯†è™½ä¸å›°éš¾ï¼Œä½†æ ·å¼å®åœ¨ä¸å¯æ­ç»´ã€‚è¿™é‡Œé‡‡ç”¨å¤§ç¥åšå‡ºçš„hexo-blog-encryptè¿›è¡ŒåŠ å¯†ã€‚ å®‰è£…12cd åšå®¢æ ¹ç›®å½•npm install hexo-blog-encrypt --save é…ç½®æ ¹æœ¬é…ç½®æ‰“å¼€æ ¹ç›®å½•ä¸­çš„ _config.yml æ–‡ä»¶,æ·»åŠ  12encrypt: enable: true è‡ªå®šä¹‰é…ç½®ç„¶ååœ¨blogçš„å¤´éƒ¨æ·»åŠ ä¸Šå¯¹åº”çš„å­—æ®µï¼Œå¦‚password, abstract, messageã€‚ 1234567---title: æ–‡ç« åŠ å¯†date: 2019-08-06 19:00:02password: ä½ çš„å¯†ç abstract: æ˜¾ç¤ºåœ¨ç›®å½•é¡µæˆ–é¦–é¡µçš„å†…å®¹ç®€ä»‹ã€‚message: æ­¤å¤„ä¸ºè¾“å…¥å¯†ç æ—¶çš„æç¤ºå†…å®¹ã€‚--- å…¨å±€é…ç½®å¸Œæœ›ä¿®æ”¹é»˜è®¤çš„æç¤ºå’Œæ‘˜è¦å†…å®¹æ—¶ï¼Œä½ å¯ä»¥æ·»åŠ å¦‚ä¸‹é…ç½®åœ¨æ ¹ç›®å½•ä¸­çš„ _config.yml æ–‡ä»¶ä¸­ã€‚ 1234encrypt: enable: true default_abstract: è¿™æ˜¯ä¸€ç¯‡åŠ å¯†æ–‡ç« ï¼Œå†…å®¹å¯èƒ½æ˜¯xxx default_message: è¾“å…¥å¯†ç ï¼ŒæŸ¥çœ‹æ–‡ç« ã€‚","categories":[{"name":"å»ºç«™æ—¥å¿—","slug":"å»ºç«™æ—¥å¿—","permalink":"http://rootreturn0.github.io/categories/å»ºç«™æ—¥å¿—/"}],"tags":[{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"http://rootreturn0.github.io/tags/æ—¥å¿—/"}]},{"title":"hello world","slug":"hello-world","date":"2019-07-25T12:43:01.000Z","updated":"2019-07-26T14:28:49.946Z","comments":true,"path":"2019/07/25/hello-world/","link":"","permalink":"http://rootreturn0.github.io/2019/07/25/hello-world/","excerpt":"","text":"12345#include &lt;iostream&gt;int main()&#123; std::cout&lt;&lt;\"Hello world!\"&lt;&lt;std::endl;&#125; 12def hello() print('Hello world!')","categories":[],"tags":[]}]}